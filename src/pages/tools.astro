---
import Layout from "@/components/Layout.astro";
---

<Layout
  title="å·¥å…·ä¸­å¿ƒ"
  description="åœ¨çº¿å·¥å…·é›†åˆ - æ¸¸æˆå¨±ä¹ä¸çˆ¬è™«æ¼”ç¤º"
  skipSrTitle={false}
  transparentNav={true}
>
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
  </head>

  <div
    class="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 dark:from-gray-900 dark:to-gray-800 no-zoom"
  >
    <div class="container mx-auto px-4 py-6 md:py-8">
      <!-- é¡µé¢æ ‡é¢˜ -->
      <div class="text-center mb-6 md:mb-8">
        <h1
          class="text-3xl md:text-4xl font-bold text-gray-800 dark:text-gray-200 mb-2"
        >
          ğŸ› ï¸ å·¥å…·ä¸­å¿ƒ
        </h1>
        <p class="text-gray-600 dark:text-gray-400 mb-4 px-4">
          é€‰æ‹©ä½ éœ€è¦çš„å·¥å…· - æ¸¸æˆå¨±ä¹æˆ–å®ç”¨æ¼”ç¤º
        </p>
        <div
          class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3 md:p-4 max-w-2xl mx-auto mx-4"
        >
          <p class="text-xs md:text-sm text-blue-700 dark:text-blue-300">
            ğŸ’¡ <strong>ä½¿ç”¨æç¤ºï¼š</strong
            >ç”±äºæµè§ˆå™¨å…¼å®¹é—®é¢˜ï¼Œå¦‚ç‚¹å‡»æ²¡ååº”è¯·å…ˆåˆ·æ–°é¡µé¢å†å°è¯•ç‚¹å‡»ã€‚
          </p>
        </div>
      </div>

      <!-- åˆ†ç±»é€‰æ‹©å™¨ -->
      <div class="flex justify-center mb-6 md:mb-8 px-4">
        <div
          class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-1 md:p-2 flex space-x-1 md:space-x-2 w-full max-w-md"
        >
          <button
            id="tab-games"
            class="tab-button active flex-1 px-3 md:px-6 py-2 md:py-3 rounded-lg font-semibold transition-all duration-300 bg-blue-500 text-white text-sm md:text-base"
          >
            ğŸ® æ¸¸æˆå¨±ä¹
          </button>
          <button
            id="tab-scrapers"
            class="tab-button flex-1 px-3 md:px-6 py-2 md:py-3 rounded-lg font-semibold transition-all duration-300 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm md:text-base"
          >
            ğŸ•·ï¸ çˆ¬è™«æ¼”ç¤º
          </button>
        </div>
      </div>

      <div class="max-w-6xl mx-auto">
        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div id="games-section" class="section-content">
          <!-- æ¸¸æˆåˆ—è¡¨ -->
          <div
            id="games-list"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
          >
            <!-- è´ªåƒè›‡æ¸¸æˆå¡ç‰‡ -->
            <div
              class="game-card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-105"
              data-game="snake"
            >
              <div class="text-center">
                <div class="text-6xl mb-4">ğŸ</div>
                <h3
                  class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2"
                >
                  è´ªåƒè›‡
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4">
                  ç»å…¸è´ªåƒè›‡æ¸¸æˆï¼ŒæŒ‘æˆ˜ä½ çš„ååº”é€Ÿåº¦
                </p>
                <div class="flex flex-wrap gap-2 justify-center">
                  <span
                    class="px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full text-xs"
                    >å•äººæ¨¡å¼</span
                  >
                  <span
                    class="px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full text-xs"
                    >åŒäººæ¨¡å¼</span
                  >
                  <span
                    class="px-2 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-full text-xs"
                    >é—¯å…³æ¨¡å¼</span
                  >
                </div>
              </div>
            </div>

            <!-- äº”å­æ£‹æ¸¸æˆå¡ç‰‡ -->
            <div
              class="game-card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-105"
              data-game="gomoku"
            >
              <div class="text-center">
                <div class="text-6xl mb-4">âš«</div>
                <h3
                  class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2"
                >
                  äº”å­æ£‹
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4">
                  ç»å…¸äº”å­æ£‹æ¸¸æˆï¼Œå…ˆè¿æˆäº”å­è€…è·èƒœ
                </p>
                <div class="flex flex-wrap gap-2 justify-center">
                  <span
                    class="px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full text-xs"
                    >äººæœºå¯¹æˆ˜</span
                  >
                  <span
                    class="px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full text-xs"
                    >åŒäººå¯¹æˆ˜</span
                  >
                </div>
              </div>
            </div>

            <!-- æ›´å¤šæ¸¸æˆå ä½ç¬¦ -->
            <div
              class="game-card bg-gray-100 dark:bg-gray-700 rounded-xl shadow-lg p-6 cursor-not-allowed opacity-50"
            >
              <div class="text-center">
                <div class="text-6xl mb-4">ğŸ®</div>
                <h3
                  class="text-2xl font-bold text-gray-600 dark:text-gray-400 mb-2"
                >
                  æ›´å¤šæ¸¸æˆ
                </h3>
                <p class="text-gray-500 dark:text-gray-500 mb-4">æ•¬è¯·æœŸå¾…...</p>
                <span
                  class="px-2 py-1 bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-400 rounded-full text-xs"
                  >å³å°†æ¨å‡º</span
                >
              </div>
            </div>
          </div>

          <!-- è´ªåƒè›‡æ¸¸æˆç•Œé¢ -->
          <div id="snake-game-container" class="game-container hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
              <div class="flex items-center justify-between mb-4 md:mb-6">
                <div class="flex items-center">
                  <div class="text-2xl md:text-3xl mr-2 md:mr-4">ğŸ</div>
                  <div>
                    <h2
                      class="text-xl md:text-2xl font-bold text-gray-800 dark:text-gray-200"
                    >
                      è´ªåƒè›‡
                    </h2>
                    <p
                      class="text-sm md:text-base text-gray-600 dark:text-gray-400"
                    >
                      é€‰æ‹©æ¸¸æˆæ¨¡å¼å¼€å§‹æ¸¸æˆ
                    </p>
                  </div>
                </div>
                <button
                  id="back-to-games"
                  class="px-2 md:px-4 py-1 md:py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors text-sm md:text-base"
                >
                  â† è¿”å›
                </button>
              </div>

              <div id="snake-mode-selection" class="text-center mb-6">
                <div
                  class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto"
                >
                  <button
                    id="snake-single"
                    class="p-4 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-colors flex flex-col items-center space-y-2"
                  >
                    <span class="text-2xl">ğŸ‘¤</span>
                    <span>å•äººæ¨¡å¼</span>
                  </button>
                  <button
                    id="snake-double"
                    class="p-4 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-colors flex flex-col items-center space-y-2"
                  >
                    <span class="text-2xl">ğŸ‘¥</span>
                    <span>åŒäººæ¨¡å¼</span>
                  </button>
                  <button
                    id="snake-challenge"
                    class="p-4 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-semibold transition-colors flex flex-col items-center space-y-2"
                  >
                    <span class="text-2xl">ğŸ†</span>
                    <span>é—¯å…³æ¨¡å¼</span>
                  </button>
                </div>
              </div>

              <div id="snake-game-area" class="hidden text-center">
                <div class="flex justify-center mb-4">
                  <canvas
                    id="snake-canvas"
                    width="600"
                    height="400"
                    class="border-2 border-gray-300 dark:border-gray-600 bg-black rounded-lg max-w-full h-auto touch-manipulation"
                    style="max-height: 60vh;"></canvas>
                </div>
                <div id="snake-controls">
                  <p
                    class="text-base md:text-lg text-gray-600 dark:text-gray-400 mb-2"
                  >
                    å¾—åˆ†: <span
                      id="snake-score"
                      class="font-bold text-xl md:text-2xl text-green-600"
                      >0</span
                    >
                  </p>
                  <div
                    id="snake-control-info"
                    class="text-xs md:text-sm text-gray-500 dark:text-gray-400 mb-4 px-2"
                  >
                    <!-- æ§åˆ¶è¯´æ˜å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                  </div>
                  <!-- ç§»åŠ¨ç«¯è§¦å±æ§åˆ¶æŒ‰é’® -->
                  <div
                    id="snake-buttons"
                    class="grid grid-cols-3 gap-2 max-w-xs mx-auto mb-4 md:hidden"
                  >
                    <div></div>
                    <button
                      id="snake-up"
                      class="px-4 py-3 bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white rounded-lg transition-colors text-lg font-bold touch-manipulation"
                      >â†‘</button
                    >
                    <div></div>
                    <button
                      id="snake-left"
                      class="px-4 py-3 bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white rounded-lg transition-colors text-lg font-bold touch-manipulation"
                      >â†</button
                    >
                    <div></div>
                    <button
                      id="snake-right"
                      class="px-4 py-3 bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white rounded-lg transition-colors text-lg font-bold touch-manipulation"
                      >â†’</button
                    >
                    <div></div>
                    <button
                      id="snake-down"
                      class="px-4 py-3 bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white rounded-lg transition-colors text-lg font-bold touch-manipulation"
                      >â†“</button
                    >
                    <div></div>
                  </div>
                  <!-- æ¡Œé¢ç«¯æ§åˆ¶è¯´æ˜ -->
                  <div
                    class="hidden md:block text-sm text-gray-500 dark:text-gray-400 mb-4"
                  >
                    ä½¿ç”¨æ–¹å‘é”®æˆ–WASDæ§åˆ¶è›‡çš„ç§»åŠ¨
                  </div>
                  <button
                    id="snake-back"
                    class="px-4 md:px-6 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors text-sm md:text-base"
                    >è¿”å›æ¨¡å¼é€‰æ‹©</button
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- äº”å­æ£‹æ¸¸æˆç•Œé¢ -->
          <div id="gomoku-game-container" class="game-container hidden">
            <div
              class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 md:p-6"
            >
              <div class="flex items-center justify-between mb-4 md:mb-6">
                <div class="flex items-center">
                  <div class="text-2xl md:text-3xl mr-2 md:mr-4">âš«</div>
                  <div>
                    <h2
                      class="text-xl md:text-2xl font-bold text-gray-800 dark:text-gray-200"
                    >
                      äº”å­æ£‹
                    </h2>
                    <p
                      class="text-sm md:text-base text-gray-600 dark:text-gray-400"
                    >
                      é€‰æ‹©å¯¹æˆ˜æ¨¡å¼å¼€å§‹æ¸¸æˆ
                    </p>
                  </div>
                </div>
                <button
                  id="back-to-games-gomoku"
                  class="px-2 md:px-4 py-1 md:py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors text-sm md:text-base"
                >
                  â† è¿”å›
                </button>
              </div>

              <div id="gomoku-mode-selection" class="text-center mb-6">
                <div
                  class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-lg mx-auto"
                >
                  <button
                    id="gomoku-single"
                    class="p-4 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-colors flex flex-col items-center space-y-2"
                  >
                    <span class="text-2xl">ğŸ¤–</span>
                    <span>äººæœºå¯¹æˆ˜</span>
                  </button>
                  <button
                    id="gomoku-double"
                    class="p-4 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-colors flex flex-col items-center space-y-2"
                  >
                    <span class="text-2xl">ğŸ‘¥</span>
                    <span>åŒäººå¯¹æˆ˜</span>
                  </button>
                </div>
              </div>

              <div id="gomoku-game-area" class="hidden text-center">
                <div class="flex justify-center mb-4">
                  <canvas
                    id="gomoku-canvas"
                    width="560"
                    height="560"
                    class="border-2 border-gray-300 dark:border-gray-600 bg-yellow-100 dark:bg-yellow-900 rounded-lg max-w-full h-auto touch-manipulation"
                    style="max-height: 70vh;"></canvas>
                </div>
                <div id="gomoku-info">
                  <p
                    class="text-base md:text-lg text-gray-600 dark:text-gray-400 mb-4"
                  >
                    å½“å‰ç©å®¶: <span
                      id="current-player"
                      class="font-bold text-lg md:text-xl">é»‘å­</span
                    >
                  </p>
                  <div
                    class="flex flex-col sm:flex-row gap-2 sm:gap-4 justify-center"
                  >
                    <button
                      id="gomoku-restart"
                      class="px-4 md:px-6 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors text-sm md:text-base"
                      >é‡æ–°å¼€å§‹</button
                    >
                    <button
                      id="gomoku-back"
                      class="px-4 md:px-6 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors text-sm md:text-base"
                      >è¿”å›æ¨¡å¼é€‰æ‹©</button
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- çˆ¬è™«æ¼”ç¤ºåŒºåŸŸ -->
        <div id="scrapers-section" class="section-content hidden">
          <!-- çˆ¬è™«åˆ—è¡¨ -->
          <div
            id="scrapers-list"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
          >
            <!-- è”¬èœä»·æ ¼çˆ¬è™«å¡ç‰‡ -->
            <div
              class="scraper-card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-105"
              data-scraper="vegetable"
            >
              <div class="text-center">
                <div class="text-6xl mb-4">ğŸ¥¬</div>
                <h3
                  class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2"
                >
                  è”¬èœä»·æ ¼
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4">
                  å®æ—¶è·å–åŒ—äº¬åœ°åŒºè”¬èœä»·æ ¼ä¿¡æ¯
                </p>
                <div class="flex flex-wrap gap-2 justify-center">
                  <span
                    class="px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full text-xs"
                    >å®æ—¶æ•°æ®</span
                  >
                  <span
                    class="px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full text-xs"
                    >åˆ†é¡µçˆ¬å–</span
                  >
                </div>
              </div>
            </div>

            <!-- å¤©æ°”æ•°æ®çˆ¬è™«å¡ç‰‡ -->
            <div
              class="scraper-card bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-105"
              data-scraper="weather"
            >
              <div class="text-center">
                <div class="text-6xl mb-4">ğŸŒ¤ï¸</div>
                <h3
                  class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2"
                >
                  å¤©æ°”æ•°æ®
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4">
                  è·å–æŒ‡å®šçœä»½çš„å¤©æ°”ä¿¡æ¯
                </p>
                <div class="flex flex-wrap gap-2 justify-center">
                  <span
                    class="px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full text-xs"
                    >çœä»½ç­›é€‰</span
                  >
                  <span
                    class="px-2 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-full text-xs"
                    >å®æ—¶å¤©æ°”</span
                  >
                </div>
              </div>
            </div>

            <!-- æ›´å¤šçˆ¬è™«å ä½ç¬¦ -->
            <div
              class="scraper-card bg-gray-100 dark:bg-gray-700 rounded-xl shadow-lg p-6 cursor-not-allowed opacity-50"
            >
              <div class="text-center">
                <div class="text-6xl mb-4">ğŸ•·ï¸</div>
                <h3
                  class="text-2xl font-bold text-gray-600 dark:text-gray-400 mb-2"
                >
                  æ›´å¤šçˆ¬è™«
                </h3>
                <p class="text-gray-500 dark:text-gray-500 mb-4">æ•¬è¯·æœŸå¾…...</p>
                <span
                  class="px-2 py-1 bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-400 rounded-full text-xs"
                  >å³å°†æ¨å‡º</span
                >
              </div>
            </div>
          </div>

          <!-- è”¬èœä»·æ ¼çˆ¬è™«ç•Œé¢ -->
          <div
            id="vegetable-scraper-container"
            class="scraper-container hidden"
          >
            <div
              class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 md:p-6"
            >
              <div class="flex items-center justify-between mb-4 md:mb-6">
                <div class="flex items-center">
                  <div class="text-2xl md:text-3xl mr-2 md:mr-4">ğŸ¥¬</div>
                  <div>
                    <h2
                      class="text-lg md:text-2xl font-bold text-gray-800 dark:text-gray-200"
                    >
                      åŒ—äº¬è”¬èœä»·æ ¼çˆ¬å–
                    </h2>
                    <p
                      class="text-sm md:text-base text-gray-600 dark:text-gray-400"
                    >
                      è®¾ç½®çˆ¬å–å‚æ•°å¹¶å¼€å§‹è·å–æ•°æ®
                    </p>
                  </div>
                </div>
                <button
                  id="back-to-scrapers"
                  class="px-2 md:px-4 py-1 md:py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors text-sm md:text-base"
                >
                  â† è¿”å›
                </button>
              </div>

              <form id="vegetable-form" class="mb-4 md:mb-6">
                <div
                  class="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4 mb-4"
                >
                  <div>
                    <label
                      for="start-page"
                      class="block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                      >å¼€å§‹é¡µç :</label
                    >
                    <input
                      type="number"
                      id="start-page"
                      value="1"
                      min="1"
                      class="w-full px-3 md:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white text-sm md:text-base"
                    />
                  </div>
                  <div>
                    <label
                      for="end-page"
                      class="block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                      >ç»“æŸé¡µç :</label
                    >
                    <input
                      type="number"
                      id="end-page"
                      value="2"
                      min="1"
                      class="w-full px-3 md:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white text-sm md:text-base"
                    />
                  </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                  <button
                    type="submit"
                    class="flex-1 px-4 md:px-6 py-2 md:py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-colors text-sm md:text-base"
                  >
                    ğŸš€ å¼€å§‹çˆ¬å–è”¬èœä»·æ ¼
                  </button>
                  <button
                    type="button"
                    id="pause-vegetable"
                    class="px-4 md:px-6 py-2 md:py-3 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg font-semibold transition-colors text-sm md:text-base"
                    style="display: none;"
                  >
                    â¸ï¸ æš‚åœ
                  </button>
                  <button
                    type="button"
                    id="resume-vegetable"
                    class="px-4 md:px-6 py-2 md:py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-colors text-sm md:text-base"
                    style="display: none;"
                  >
                    â–¶ï¸ ç»§ç»­
                  </button>
                </div>
              </form>

              <div
                id="vegetable-results"
                class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 md:p-6 min-h-[300px] md:min-h-[400px] overflow-y-auto smooth-scroll"
              >
                <p
                  class="text-gray-500 dark:text-gray-400 text-center text-sm md:text-base"
                >
                  è®¾ç½®é¡µç èŒƒå›´å¹¶ç‚¹å‡»å¼€å§‹çˆ¬å–æŒ‰é’®
                </p>
              </div>
            </div>
          </div>

          <!-- å¤©æ°”æ•°æ®çˆ¬è™«ç•Œé¢ -->
          <div id="weather-scraper-container" class="scraper-container hidden">
            <div
              class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 md:p-6"
            >
              <div class="flex items-center justify-between mb-4 md:mb-6">
                <div class="flex items-center">
                  <div class="text-2xl md:text-3xl mr-2 md:mr-4">ğŸŒ¤ï¸</div>
                  <div>
                    <h2
                      class="text-lg md:text-2xl font-bold text-gray-800 dark:text-gray-200"
                    >
                      å¤©æ°”æ•°æ®çˆ¬å–
                    </h2>
                    <p
                      class="text-sm md:text-base text-gray-600 dark:text-gray-400"
                    >
                      è¾“å…¥çœä»½åç§°è·å–å¤©æ°”ä¿¡æ¯
                    </p>
                  </div>
                </div>
                <button
                  id="back-to-scrapers-weather"
                  class="px-2 md:px-4 py-1 md:py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors text-sm md:text-base"
                >
                  â† è¿”å›
                </button>
              </div>

              <div class="mb-4 md:mb-6">
                <div class="mb-4">
                  <label
                    for="province-id"
                    class="block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                    >çœä»½åç§°:</label
                  >
                  <input
                    type="text"
                    id="province-id"
                    placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿ä¸œ"
                    value="åŒ—äº¬"
                    class="w-full px-3 md:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white text-sm md:text-base"
                  />
                </div>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                  <button
                    id="fetch-weather"
                    class="flex-1 px-4 md:px-6 py-2 md:py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-colors text-sm md:text-base"
                  >
                    ğŸŒ è·å–å¤©æ°”æ•°æ®
                  </button>
                  <button
                    type="button"
                    id="pause-weather"
                    class="px-4 md:px-6 py-2 md:py-3 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg font-semibold transition-colors text-sm md:text-base"
                    style="display: none;"
                  >
                    â¸ï¸ æš‚åœ
                  </button>
                  <button
                    type="button"
                    id="resume-weather"
                    class="px-4 md:px-6 py-2 md:py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-colors text-sm md:text-base"
                    style="display: none;"
                  >
                    â–¶ï¸ ç»§ç»­
                  </button>
                </div>
              </div>

              <div
                id="weather-results"
                class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 md:p-6 min-h-[300px] md:min-h-[400px] overflow-y-auto smooth-scroll"
              >
                <p
                  class="text-gray-500 dark:text-gray-400 text-center text-sm md:text-base"
                >
                  è¾“å…¥çœä»½åç§°å¹¶ç‚¹å‡»è·å–å¤©æ°”æ•°æ®æŒ‰é’®
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<style>
  .tab-button.active {
    background-color: #3b82f6;
    color: white;
    box-shadow:
      0 10px 15px -3px rgba(0, 0, 0, 0.1),
      0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }

  .section-content {
    transition: all 0.3s ease-in-out;
  }

  .section-content.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .game-card,
  .scraper-card {
    border: 2px solid transparent;
    transition: all 0.3s ease;
  }

  .game-card:hover,
  .scraper-card:hover {
    border-color: #3b82f6;
    transform: translateY(-4px);
  }

  .game-container,
  .scraper-container {
    animation: fadeIn 0.3s ease-in-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .weather-list {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    list-style: none;
    padding: 0;
    margin: 1rem 0;
  }

  .weather-card {
    background: linear-gradient(135deg, #e0e7ff 0%, #f0fdfa 100%);
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
    padding: 1rem 1.5rem;
    min-width: 220px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    font-size: 1.1rem;
    color: #222;
    border: 1px solid #c7d2fe;
    transition: box-shadow 0.2s;
  }

  .weather-card:hover {
    box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15);
  }

  .weather-city {
    font-weight: bold;
    font-size: 1.2rem;
    margin-bottom: 0.3rem;
    color: #2563eb;
  }

  .weather-info {
    color: #374151;
  }

  /* å“åº”å¼è°ƒæ•´ */
  @media (max-width: 768px) {
    .container {
      padding-left: 1rem;
      padding-right: 1rem;
    }

    #snake-canvas,
    #gomoku-canvas {
      max-width: 100%;
      height: auto;
    }

    .grid.grid-cols-1.lg\\:grid-cols-2 {
      grid-template-columns: 1fr;
    }

    .tab-button {
      font-size: 0.875rem;
      padding: 0.5rem 1rem;
    }

    /* æ¸¸æˆå¡ç‰‡ç§»åŠ¨ç«¯ä¼˜åŒ– */
    .game-card,
    .scraper-card {
      padding: 1rem;
    }

    .game-card h3,
    .scraper-card h3 {
      font-size: 1.25rem;
    }

    .game-card .text-6xl,
    .scraper-card .text-6xl {
      font-size: 3rem;
    }

    /* å¤©æ°”å¡ç‰‡ç§»åŠ¨ç«¯ä¼˜åŒ– */
    .weather-card {
      min-width: 180px;
      padding: 0.75rem 1rem;
      font-size: 1rem;
    }

    .weather-city {
      font-size: 1.1rem;
    }
  }

  @media (max-width: 640px) {
    .container {
      padding-left: 0.75rem;
      padding-right: 0.75rem;
    }

    .grid.grid-cols-1.md\\:grid-cols-3 {
      grid-template-columns: 1fr;
    }

    .grid.grid-cols-1.md\\:grid-cols-2 {
      grid-template-columns: 1fr;
    }

    .grid.grid-cols-2 {
      grid-template-columns: 1fr;
    }

    /* ç§»åŠ¨ç«¯è§¦å±ä¼˜åŒ– */
    .touch-manipulation {
      touch-action: manipulation;
    }

    /* æŒ‰é’®é—´è·ä¼˜åŒ– */
    .game-card,
    .scraper-card {
      margin-bottom: 1rem;
    }

    /* è¡¨å•å…ƒç´ ç§»åŠ¨ç«¯ä¼˜åŒ– */
    input[type="number"],
    input[type="text"] {
      font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
    }

    /* å¤©æ°”åˆ—è¡¨ç§»åŠ¨ç«¯ä¼˜åŒ– */
    .weather-list {
      gap: 0.75rem;
    }

    .weather-card {
      min-width: 160px;
      padding: 0.5rem 0.75rem;
      font-size: 0.9rem;
    }

    .weather-city {
      font-size: 1rem;
    }
  }

  @media (max-width: 480px) {
    /* è¶…å°å±å¹•ä¼˜åŒ– */
    .text-3xl {
      font-size: 1.5rem;
    }

    .text-4xl {
      font-size: 1.75rem;
    }

    .game-card .text-6xl,
    .scraper-card .text-6xl {
      font-size: 2.5rem;
    }

    /* Canvas è¶…å°å±å¹•é€‚é… */
    #snake-canvas {
      max-height: 50vh;
    }

    #gomoku-canvas {
      max-height: 60vh;
    }

    /* ç»“æœåŒºåŸŸé«˜åº¦è°ƒæ•´ */
    #vegetable-results,
    #weather-results {
      min-height: 250px;
    }
  }

  /* åŠ è½½åŠ¨ç”» */
  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }

  .loading {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  /* è§¦å±ä¼˜åŒ– */
  .touch-manipulation {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* ç§»åŠ¨ç«¯æŒ‰é’®æ¿€æ´»çŠ¶æ€ */
  @media (hover: none) and (pointer: coarse) {
    .game-card:active,
    .scraper-card:active {
      transform: scale(0.98);
      transition: transform 0.1s ease;
    }

    button:active {
      transform: scale(0.95);
      transition: transform 0.1s ease;
    }
  }

  /* é˜²æ­¢ç§»åŠ¨ç«¯åŒå‡»ç¼©æ”¾ */
  .no-zoom {
    touch-action: pan-x pan-y;
  }

  /* ç§»åŠ¨ç«¯æ»šåŠ¨ä¼˜åŒ– */
  .smooth-scroll {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }
</style>

<script is:inline>
  // å…¨å±€é¢„åŠ è½½è„šæœ¬ - åœ¨ä»»ä½•é¡µé¢éƒ½ä¼šæ‰§è¡Œ
  (function () {
    // å·¥å…·é¡µé¢é¢„åŠ è½½æ ‡è¯†
    window.toolsPagePreloaded = window.toolsPagePreloaded || false;

    // é¢„åŠ è½½å·¥å…·é¡µé¢è„šæœ¬çš„å‡½æ•°
    function preloadToolsPageScripts() {
      if (window.toolsPagePreloaded) return;

      window.toolsPagePreloaded = true;

      // é¢„åŠ è½½æ ‡è®°
      sessionStorage.setItem("tools_preloaded", "true");

      // é¢„å®šä¹‰æ‰€æœ‰å·¥å…·é¡µé¢éœ€è¦çš„å‡½æ•°å’Œå˜é‡
      window.toolsPageReady = {
        initialized: false,
        functions: {},
        classes: {},
        variables: {},
      };

      // é¢„åŠ è½½æ ¸å¿ƒæ¸¸æˆç±»å®šä¹‰
      try {
        // é¢„å®šä¹‰è´ªåƒè›‡æ¸¸æˆç±»çš„åŸºæœ¬ç»“æ„
        window.toolsPageReady.classes.SnakeGame = function (canvas, mode) {
          this.canvas = canvas;
          this.mode = mode;
          this.preloaded = true;
        };

        // é¢„å®šä¹‰äº”å­æ£‹æ¸¸æˆç±»çš„åŸºæœ¬ç»“æ„
        window.toolsPageReady.classes.GomokuGame = function (canvas, mode) {
          this.canvas = canvas;
          this.mode = mode;
          this.preloaded = true;
        };

        // é¢„å®šä¹‰æ ¸å¿ƒå˜é‡
        window.toolsPageReady.variables = {
          currentGame: null,
          vegetableAbortController: null,
          weatherAbortController: null,
          isVegetablePaused: false,
          isWeatherPaused: false,
          currentVegetablePage: 1,
        };
      } catch (error) {
        // é™é»˜å¤„ç†é”™è¯¯
      }
    }

    // æŸ¥æ‰¾å·¥å…·ä¸­å¿ƒé“¾æ¥å¹¶æ·»åŠ é¢„åŠ è½½äº‹ä»¶
    function setupToolsPreloading() {
      // å¦‚æœå·²ç»åœ¨å·¥å…·é¡µé¢ï¼Œä¸éœ€è¦è®¾ç½®é¢„åŠ è½½
      if (window.location.pathname === "/tools") {
        return;
      }

      // æŸ¥æ‰¾æ‰€æœ‰æŒ‡å‘ /tools çš„é“¾æ¥
      const toolsLinks = document.querySelectorAll(
        'a[href="/tools"], a[href*="/tools"]'
      );

      toolsLinks.forEach((link) => {
        // é¿å…é‡å¤ç»‘å®š
        if (link.dataset.toolsPreloadBound) return;
        link.dataset.toolsPreloadBound = "true";

        // é¼ æ ‡æ‚¬æµ®é¢„åŠ è½½
        link.addEventListener("mouseenter", preloadToolsPageScripts, {
          once: true,
        });

        // è§¦å±è®¾å¤‡çš„è§¦æ‘¸é¢„åŠ è½½
        link.addEventListener("touchstart", preloadToolsPageScripts, {
          once: true,
        });

        // ç„¦ç‚¹é¢„åŠ è½½ï¼ˆé”®ç›˜å¯¼èˆªï¼‰
        link.addEventListener("focus", preloadToolsPageScripts, { once: true });
      });

      // æŸ¥æ‰¾å¯¼èˆªèœå•ä¸­çš„"å…¶ä»–"åˆ†ç»„
      const otherGroupToggle = document.querySelector(
        '[data-toggle-id="other"]'
      );
      if (otherGroupToggle && !otherGroupToggle.dataset.toolsPreloadBound) {
        otherGroupToggle.dataset.toolsPreloadBound = "true";

        // å½“ç”¨æˆ·æ‚¬æµ®æˆ–ç‚¹å‡»"å…¶ä»–"åˆ†ç»„æ—¶ä¹Ÿé¢„åŠ è½½
        otherGroupToggle.addEventListener(
          "mouseenter",
          preloadToolsPageScripts,
          { once: true }
        );
        otherGroupToggle.addEventListener("click", preloadToolsPageScripts, {
          once: true,
        });
      }

      // æŸ¥æ‰¾ç§»åŠ¨ç«¯èœå•ä¸­çš„å·¥å…·é“¾æ¥
      const mobileToolsLinks = document.querySelectorAll(
        '#mobile-menu a[href="/tools"], #mobile-menu a[href*="/tools"]'
      );
      mobileToolsLinks.forEach((link) => {
        if (link.dataset.toolsPreloadBound) return;
        link.dataset.toolsPreloadBound = "true";

        link.addEventListener("touchstart", preloadToolsPageScripts, {
          once: true,
        });
        link.addEventListener("focus", preloadToolsPageScripts, { once: true });
      });
    }

    // é¡µé¢åŠ è½½å®Œæˆåè®¾ç½®é¢„åŠ è½½
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", setupToolsPreloading);
    } else {
      setupToolsPreloading();
    }

    // ç›‘å¬é¡µé¢åˆ‡æ¢äº‹ä»¶ï¼Œé‡æ–°è®¾ç½®é¢„åŠ è½½
    document.addEventListener("astro:page-load", setupToolsPreloading);
    document.addEventListener("page-transition", setupToolsPreloading);

    // å»¶è¿Ÿè®¾ç½®ï¼Œç¡®ä¿åŠ¨æ€å†…å®¹ä¹Ÿè¢«è¦†ç›–
    setTimeout(setupToolsPreloading, 1000);
  })();
</script>

<script is:inline>
  // å…¨å±€å˜é‡ - ä½¿ç”¨æ¡ä»¶å£°æ˜é¿å…é‡å¤å£°æ˜é”™è¯¯
  if (typeof currentGame === "undefined") {
    var currentGame = null;
    var vegetableAbortController = null;
    var weatherAbortController = null;
    var isVegetablePaused = false;
    var isWeatherPaused = false;
    var currentVegetablePage = 1;
  }

  // åˆå§‹åŒ–å‡½æ•° - é¿å…é‡å¤å£°æ˜
  if (typeof initializeToolsPage === "undefined") {
    var initializeToolsPage = function () {
      // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
      if (window.toolsPageReady && window.toolsPageReady.initialized) {
        // é‡ç½®åˆå§‹åŒ–çŠ¶æ€ï¼Œå…è®¸é‡æ–°åˆå§‹åŒ–
        window.toolsPageReady.initialized = false;
      }

      const tabGames = document.getElementById("tab-games");
      const tabScrapers = document.getElementById("tab-scrapers");
      const gamesSection = document.getElementById("games-section");
      const scrapersSection = document.getElementById("scrapers-section");

      // æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç¨åé‡è¯•
      if (!tabGames || !tabScrapers || !gamesSection || !scrapersSection) {
        setTimeout(initializeToolsPage, 100);
        return;
      }

      // å¦‚æœæœ‰é¢„åŠ è½½çš„å˜é‡ï¼Œåˆå¹¶å®ƒä»¬ï¼ˆä½†ä¸è¦†ç›–å·²å­˜åœ¨çš„å€¼ï¼‰
      if (window.toolsPageReady && window.toolsPageReady.variables) {
        const preloadedVars = window.toolsPageReady.variables;
        // åªåœ¨å˜é‡æœªå®šä¹‰æ—¶ä½¿ç”¨é¢„åŠ è½½çš„å€¼
        if (typeof currentGame === "undefined")
          currentGame = preloadedVars.currentGame;
        if (typeof vegetableAbortController === "undefined")
          vegetableAbortController = preloadedVars.vegetableAbortController;
        if (typeof weatherAbortController === "undefined")
          weatherAbortController = preloadedVars.weatherAbortController;
        if (typeof isVegetablePaused === "undefined")
          isVegetablePaused = preloadedVars.isVegetablePaused;
        if (typeof isWeatherPaused === "undefined")
          isWeatherPaused = preloadedVars.isWeatherPaused;
        if (typeof currentVegetablePage === "undefined")
          currentVegetablePage = preloadedVars.currentVegetablePage;
      }

      function switchTab(
        activeTab,
        activeSection,
        inactiveTab,
        inactiveSection
      ) {
        // æ›´æ–°æ ‡ç­¾æ ·å¼
        activeTab.classList.add("active", "bg-blue-500", "text-white");
        activeTab.classList.remove(
          "text-gray-600",
          "dark:text-gray-400",
          "hover:bg-gray-100",
          "dark:hover:bg-gray-700"
        );

        inactiveTab.classList.remove("active", "bg-blue-500", "text-white");
        inactiveTab.classList.add(
          "text-gray-600",
          "dark:text-gray-400",
          "hover:bg-gray-100",
          "dark:hover:bg-gray-700"
        );

        // åˆ‡æ¢å†…å®¹åŒºåŸŸ
        activeSection.classList.remove("hidden");
        inactiveSection.classList.add("hidden");

        // é‡ç½®åˆ°åˆ—è¡¨è§†å›¾
        resetToListView();
      }

      // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      const newTabGames = tabGames.cloneNode(true);
      const newTabScrapers = tabScrapers.cloneNode(true);
      tabGames.parentNode.replaceChild(newTabGames, tabGames);
      tabScrapers.parentNode.replaceChild(newTabScrapers, tabScrapers);

      newTabGames.addEventListener("click", () => {
        switchTab(newTabGames, gamesSection, newTabScrapers, scrapersSection);
      });

      newTabScrapers.addEventListener("click", () => {
        switchTab(newTabScrapers, scrapersSection, newTabGames, gamesSection);
      });

      // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
      initializeNavigation();
      initializeGames();
      initializeScrapers();

      // æ ‡è®°åˆå§‹åŒ–å®Œæˆ
      if (window.toolsPageReady) {
        window.toolsPageReady.initialized = true;
      }
    };
  }

  // æ— æ„Ÿåˆ·æ–°åŠŸèƒ½ - é¿å…é‡å¤å£°æ˜
  if (typeof hasAutoRefreshed === "undefined") {
    var hasAutoRefreshed = false;
    var initializationAttempts = 0;
    var maxInitializationAttempts = 3;
  }

  // é¿å…é‡å¤å£°æ˜æ‰€æœ‰å‡½æ•°
  if (typeof performSilentRefresh === "undefined") {
    var performSilentRefresh = function () {
      if (hasAutoRefreshed) return;

      hasAutoRefreshed = true;
      console.log("ğŸ”„ æ‰§è¡Œæ— æ„Ÿåˆ·æ–°ä»¥ç¡®ä¿å·¥å…·é¡µé¢æ­£å¸¸å·¥ä½œ");

      // æ˜¾ç¤ºä¸€ä¸ªç®€çŸ­çš„åŠ è½½æç¤º
      const loadingDiv = document.createElement("div");
      loadingDiv.innerHTML = `
      <div style="
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(59, 130, 246, 0.9);
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 14px;
        z-index: 9999;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      ">
        ğŸ”„ æ­£åœ¨ä¼˜åŒ–é¡µé¢...
      </div>
    `;
      document.body.appendChild(loadingDiv);

      // ä½¿ç”¨ location.replace è¿›è¡Œæ— æ„Ÿåˆ·æ–°ï¼ˆä¸ä¼šåœ¨å†å²è®°å½•ä¸­ç•™ä¸‹è®°å½•ï¼‰
      setTimeout(() => {
        window.location.replace(window.location.href);
      }, 300);
    };

    var checkAndInitialize = function () {
      initializationAttempts++;

      const tabGames = document.getElementById("tab-games");
      const tabScrapers = document.getElementById("tab-scrapers");
      const gamesSection = document.getElementById("games-section");
      const scrapersSection = document.getElementById("scrapers-section");

      // æ£€æŸ¥å…³é”®å…ƒç´ æ˜¯å¦å­˜åœ¨ä¸”å¯äº¤äº’
      const elementsReady =
        tabGames && tabScrapers && gamesSection && scrapersSection;

      if (elementsReady) {
        // åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç‚¹å‡»äº‹ä»¶
        const testEvent = new Event("click", { bubbles: true });
        let testPassed = false;

        // ä¸´æ—¶ç›‘å¬å™¨æ¥æµ‹è¯•äº‹ä»¶ç³»ç»Ÿ
        const testListener = () => {
          testPassed = true;
        };
        tabGames.addEventListener("click", testListener);
        tabGames.dispatchEvent(testEvent);
        tabGames.removeEventListener("click", testListener);

        if (testPassed) {
          console.log("âœ… é¡µé¢å…ƒç´ å’Œäº‹ä»¶ç³»ç»Ÿæ­£å¸¸ï¼Œå¼€å§‹åˆå§‹åŒ–");
          initializeToolsPage();
        } else if (initializationAttempts < maxInitializationAttempts) {
          console.log(
            `âš ï¸ äº‹ä»¶ç³»ç»Ÿæœªå°±ç»ªï¼Œå°è¯• ${initializationAttempts}/${maxInitializationAttempts}`
          );
          setTimeout(checkAndInitialize, 200);
        } else {
          console.log("ğŸ”„ åˆå§‹åŒ–å¤šæ¬¡å¤±è´¥ï¼Œæ‰§è¡Œæ— æ„Ÿåˆ·æ–°");
          performSilentRefresh();
        }
      } else if (initializationAttempts < maxInitializationAttempts) {
        console.log(
          `â³ DOMå…ƒç´ æœªå°±ç»ªï¼Œå°è¯• ${initializationAttempts}/${maxInitializationAttempts}`
        );
        setTimeout(checkAndInitialize, 200);
      } else {
        console.log("ğŸ”„ DOMå…ƒç´ åŠ è½½å¤±è´¥ï¼Œæ‰§è¡Œæ— æ„Ÿåˆ·æ–°");
        performSilentRefresh();
      }
    };

    // æ£€æµ‹é¡µé¢çŠ¶æ€å’Œé¢„åŠ è½½æƒ…å†µ
    const urlParams = new URLSearchParams(window.location.search);
    const isRefreshed =
      urlParams.has("_refreshed") || sessionStorage.getItem("tools_refreshed");
    const isPreloaded = sessionStorage.getItem("tools_preloaded") === "true";

    if (isRefreshed || isPreloaded) {
      // å¦‚æœæ˜¯åˆ·æ–°åçš„é¡µé¢æˆ–å·²é¢„åŠ è½½ï¼Œç›´æ¥åˆå§‹åŒ–
      hasAutoRefreshed = true;
      sessionStorage.removeItem("tools_refreshed");

      // æ¸…ç†URLå‚æ•°
      if (urlParams.has("_refreshed")) {
        urlParams.delete("_refreshed");
        const newUrl =
          window.location.pathname +
          (urlParams.toString() ? "?" + urlParams.toString() : "");
        window.history.replaceState({}, "", newUrl);
      }

      // å¿«é€Ÿåˆå§‹åŒ– - ç»™DOMæ›´å¤šæ—¶é—´å‡†å¤‡
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", () => {
          setTimeout(initializeToolsPage, 100);
        });
      } else {
        // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿DOMå®Œå…¨å‡†å¤‡å¥½
        setTimeout(initializeToolsPage, 200);
      }

      // ä¸ºAstroé¡µé¢å¯¼èˆªæ·»åŠ æ”¯æŒ
      document.addEventListener("astro:page-load", () => {
        console.log("ğŸ”„ astro:page-load äº‹ä»¶è§¦å‘ï¼Œé‡æ–°åˆå§‹åŒ–å·¥å…·é¡µé¢");
        setTimeout(initializeToolsPage, 100);
      });

      // æ·»åŠ  astro:after-swap äº‹ä»¶æ”¯æŒï¼ˆé¡µé¢å†…å®¹æ›¿æ¢åï¼‰
      document.addEventListener("astro:after-swap", () => {
        console.log("ğŸ”„ astro:after-swap äº‹ä»¶è§¦å‘ï¼Œé‡æ–°åˆå§‹åŒ–å·¥å…·é¡µé¢");
        setTimeout(initializeToolsPage, 150);
      });

      // å¤‡ç”¨åˆå§‹åŒ–ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼‰
      setTimeout(initializeToolsPage, 500);
    } else {
      // é¦–æ¬¡è®¿é—®ä¸”æœªé¢„åŠ è½½ï¼Œè¿›è¡Œå¿«é€Ÿæ£€æŸ¥

      // æ›´çŸ­çš„å»¶è¿Ÿï¼Œå¿«é€Ÿæ£€æŸ¥
      setTimeout(() => {
        const tabGames = document.getElementById("tab-games");
        const tabScrapers = document.getElementById("tab-scrapers");

        if (tabGames && tabScrapers) {
          // ç®€å•æ£€æŸ¥å…ƒç´ æ˜¯å¦å¯äº¤äº’
          const elementsInteractive =
            tabGames.offsetParent !== null && tabScrapers.offsetParent !== null;

          if (elementsInteractive) {
            initializeToolsPage();
          } else {
            sessionStorage.setItem("tools_refreshed", "true");
            setTimeout(checkAndInitialize, 100);
          }
        } else {
          sessionStorage.setItem("tools_refreshed", "true");
          setTimeout(checkAndInitialize, 100);
        }
      }, 300); // å‡å°‘å»¶è¿Ÿæ—¶é—´
    }

    // é‡ç½®åˆ°åˆ—è¡¨è§†å›¾
    var resetToListView = function () {
      // åœæ­¢å½“å‰æ¸¸æˆ
      stopCurrentGame();

      // éšè—æ‰€æœ‰æ¸¸æˆå®¹å™¨
      document.querySelectorAll(".game-container").forEach((container) => {
        container.classList.add("hidden");
      });

      // éšè—æ‰€æœ‰çˆ¬è™«å®¹å™¨
      document.querySelectorAll(".scraper-container").forEach((container) => {
        container.classList.add("hidden");
      });

      // æ˜¾ç¤ºåˆ—è¡¨
      const gamesList = document.getElementById("games-list");
      const scrapersList = document.getElementById("scrapers-list");
      if (gamesList) gamesList.classList.remove("hidden");
      if (scrapersList) scrapersList.classList.remove("hidden");
    };

    // åˆå§‹åŒ–å¯¼èˆªåŠŸèƒ½
    var initializeNavigation = function () {
      // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨å¹¶é‡æ–°ç»‘å®šæ¸¸æˆå¡ç‰‡ç‚¹å‡»äº‹ä»¶
      const gameCards = document.querySelectorAll(".game-card");

      gameCards.forEach((card) => {
        const newCard = card.cloneNode(true);
        card.parentNode.replaceChild(newCard, card);

        newCard.addEventListener("click", () => {
          const gameType = newCard.dataset.game;
          if (gameType && gameType !== "placeholder") {
            showGameContainer(gameType);
          }
        });
      });

      // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨å¹¶é‡æ–°ç»‘å®šçˆ¬è™«å¡ç‰‡ç‚¹å‡»äº‹ä»¶
      const scraperCards = document.querySelectorAll(".scraper-card");

      scraperCards.forEach((card) => {
        const newCard = card.cloneNode(true);
        card.parentNode.replaceChild(newCard, card);

        newCard.addEventListener("click", () => {
          const scraperType = newCard.dataset.scraper;
          if (scraperType && scraperType !== "placeholder") {
            showScraperContainer(scraperType);
          }
        });
      });

      // è¿”å›æŒ‰é’®äº‹ä»¶ - ä½¿ç”¨ä¸€æ¬¡æ€§äº‹ä»¶ç›‘å¬å™¨
      const backToGames = document.getElementById("back-to-games");
      if (backToGames) {
        const newBackToGames = backToGames.cloneNode(true);
        backToGames.parentNode.replaceChild(newBackToGames, backToGames);
        newBackToGames.addEventListener("click", resetToListView);
      }

      const backToGamesGomoku = document.getElementById("back-to-games-gomoku");
      if (backToGamesGomoku) {
        const newBackToGamesGomoku = backToGamesGomoku.cloneNode(true);
        backToGamesGomoku.parentNode.replaceChild(
          newBackToGamesGomoku,
          backToGamesGomoku
        );
        newBackToGamesGomoku.addEventListener("click", resetToListView);
      }

      const backToScrapers = document.getElementById("back-to-scrapers");
      if (backToScrapers) {
        const newBackToScrapers = backToScrapers.cloneNode(true);
        backToScrapers.parentNode.replaceChild(
          newBackToScrapers,
          backToScrapers
        );
        newBackToScrapers.addEventListener("click", resetToListView);
      }

      const backToScrapersWeather = document.getElementById(
        "back-to-scrapers-weather"
      );
      if (backToScrapersWeather) {
        const newBackToScrapersWeather = backToScrapersWeather.cloneNode(true);
        backToScrapersWeather.parentNode.replaceChild(
          newBackToScrapersWeather,
          backToScrapersWeather
        );
        newBackToScrapersWeather.addEventListener("click", resetToListView);
      }
    };

    // æ˜¾ç¤ºæ¸¸æˆå®¹å™¨
    var showGameContainer = function (gameType) {
      // éšè—æ¸¸æˆåˆ—è¡¨
      document.getElementById("games-list")?.classList.add("hidden");

      // æ˜¾ç¤ºå¯¹åº”çš„æ¸¸æˆå®¹å™¨
      const container = document.getElementById(`${gameType}-game-container`);
      if (container) {
        container.classList.remove("hidden");
      }
    };

    // æ˜¾ç¤ºçˆ¬è™«å®¹å™¨
    var showScraperContainer = function (scraperType) {
      // éšè—çˆ¬è™«åˆ—è¡¨
      document.getElementById("scrapers-list")?.classList.add("hidden");

      // æ˜¾ç¤ºå¯¹åº”çš„çˆ¬è™«å®¹å™¨
      const container = document.getElementById(
        `${scraperType}-scraper-container`
      );
      if (container) {
        container.classList.remove("hidden");
      }
    };

    // è´ªåƒè›‡æ¸¸æˆç±»
    class SnakeGame {
      constructor(canvas, mode) {
        this.canvas = canvas;
        this.ctx = canvas.getContext("2d");
        this.mode = mode;
        this.gridSize = 20;
        this.lastInputTime1 = 0; // ç©å®¶1é˜²æ­¢å¿«é€ŸæŒ‰é”®
        this.lastInputTime2 = 0; // ç©å®¶2é˜²æ­¢å¿«é€ŸæŒ‰é”®
        this.inputDelay = 100; // æœ€å°è¾“å…¥é—´éš”(æ¯«ç§’)

        if (mode === "double") {
          // åŒäººæ¨¡å¼ï¼šä¸¤æ¡è›‡
          this.snake1 = [{ x: 100, y: 200 }];
          this.snake2 = [{ x: 500, y: 200 }];
          this.direction1 = "right";
          this.direction2 = "left";
          this.nextDirection1 = "right"; // é˜²æ­¢å¿«é€ŸæŒ‰é”®
          this.nextDirection2 = "left";
          this.score1 = 0;
          this.score2 = 0;
          // å­˜å‚¨ä¸Šä¸€å¸§çš„è›‡ä½ç½®ï¼Œç”¨äºæ’å€¼
          this.previousSnake1 = JSON.parse(JSON.stringify(this.snake1));
          this.previousSnake2 = JSON.parse(JSON.stringify(this.snake2));
        } else {
          // å•äººæ¨¡å¼
          this.snake = [{ x: 200, y: 200 }];
          this.direction = "right";
          this.nextDirection = "right"; // é˜²æ­¢å¿«é€ŸæŒ‰é”®
          this.score = 0;
          // å­˜å‚¨ä¸Šä¸€å¸§çš„è›‡ä½ç½®ï¼Œç”¨äºæ’å€¼
          this.previousSnake = JSON.parse(JSON.stringify(this.snake));
        }

        this.food = this.generateFood();
        this.logicInterval = null; // ç”¨äºé€»è¾‘æ›´æ–°çš„ setInterval
        this.animationFrameId = null; // ç”¨äºæ¸²æŸ“çš„ requestAnimationFrame
        this.logicSpeed = 150; // é€»è¾‘æ›´æ–°é€Ÿåº¦ (æ¯«ç§’)ï¼Œå³è›‡ç§»åŠ¨ä¸€æ ¼æ‰€éœ€æ—¶é—´
        this.lastLogicUpdateTime = 0; // ä¸Šæ¬¡é€»è¾‘æ›´æ–°çš„æ—¶é—´æˆ³
        this.isGameOver = false;

        this.bindControls();
      }

      generateFood() {
        let x, y;
        let attempts = 0;
        const maxAttempts = 100;

        do {
          x =
            Math.floor(Math.random() * (this.canvas.width / this.gridSize)) *
            this.gridSize;
          y =
            Math.floor(Math.random() * (this.canvas.height / this.gridSize)) *
            this.gridSize;
          attempts++;
        } while (this.isFoodOnSnake(x, y) && attempts < maxAttempts);

        return { x, y };
      }

      isFoodOnSnake(x, y) {
        if (this.mode === "double") {
          return (
            this.snake1.some((segment) => segment.x === x && segment.y === y) ||
            this.snake2.some((segment) => segment.x === x && segment.y === y)
          );
        } else {
          return this.snake.some(
            (segment) => segment.x === x && segment.y === y
          );
        }
      }

      bindControls() {
        // é”®ç›˜æ§åˆ¶
        document.addEventListener("keydown", (e) => {
          if (this.isGameOver) return; // æ¸¸æˆç»“æŸæ—¶ä¸å“åº”æŒ‰é”®

          const currentTime = Date.now();

          const keys = [
            "ArrowUp",
            "ArrowDown",
            "ArrowLeft",
            "ArrowRight",
            "w",
            "W",
            "s",
            "S",
            "a",
            "A",
            "d",
            "D",
          ];
          if (keys.includes(e.key)) {
            e.preventDefault();
          }

          if (this.mode === "double") {
            // åŒäººæ¨¡å¼æ§åˆ¶ - åˆ†åˆ«æ£€æŸ¥æ¯ä¸ªç©å®¶çš„è¾“å…¥é™åˆ¶
            switch (e.key) {
              // ç©å®¶1 (WASD) - æ£€æŸ¥ç©å®¶1çš„è¾“å…¥é™åˆ¶
              case "w":
              case "W":
                if (currentTime - this.lastInputTime1 < this.inputDelay) return;
                if (this.direction1 !== "down") this.nextDirection1 = "up";
                this.lastInputTime1 = currentTime;
                break;
              case "s":
              case "S":
                if (currentTime - this.lastInputTime1 < this.inputDelay) return;
                if (this.direction1 !== "up") this.nextDirection1 = "down";
                this.lastInputTime1 = currentTime;
                break;
              case "a":
              case "A":
                if (currentTime - this.lastInputTime1 < this.inputDelay) return;
                if (this.direction1 !== "right") this.nextDirection1 = "left";
                this.lastInputTime1 = currentTime;
                break;
              case "d":
              case "D":
                if (currentTime - this.lastInputTime1 < this.inputDelay) return;
                if (this.direction1 !== "left") this.nextDirection1 = "right";
                this.lastInputTime1 = currentTime;
                break;
              // ç©å®¶2 (æ–¹å‘é”®) - æ£€æŸ¥ç©å®¶2çš„è¾“å…¥é™åˆ¶
              case "ArrowUp":
                if (currentTime - this.lastInputTime2 < this.inputDelay) return;
                if (this.direction2 !== "down") this.nextDirection2 = "up";
                this.lastInputTime2 = currentTime;
                break;
              case "ArrowDown":
                if (currentTime - this.lastInputTime2 < this.inputDelay) return;
                if (this.direction2 !== "up") this.nextDirection2 = "down";
                this.lastInputTime2 = currentTime;
                break;
              case "ArrowLeft":
                if (currentTime - this.lastInputTime2 < this.inputDelay) return;
                if (this.direction2 !== "right") this.nextDirection2 = "left";
                this.lastInputTime2 = currentTime;
                break;
              case "ArrowRight":
                if (currentTime - this.lastInputTime2 < this.inputDelay) return;
                if (this.direction2 !== "left") this.nextDirection2 = "right";
                this.lastInputTime2 = currentTime;
                break;
            }
          } else {
            // å•äººæ¨¡å¼æ§åˆ¶ - ä½¿ç”¨ç©å®¶1çš„è¾“å…¥é™åˆ¶
            if (currentTime - this.lastInputTime1 < this.inputDelay) {
              return; // é˜²æ­¢å¿«é€ŸæŒ‰é”®
            }
            this.lastInputTime1 = currentTime;

            switch (e.key) {
              case "ArrowUp":
              case "w":
              case "W":
                if (this.direction !== "down") this.nextDirection = "up";
                break;
              case "ArrowDown":
              case "s":
              case "S":
                if (this.direction !== "up") this.nextDirection = "down";
                break;
              case "ArrowLeft":
              case "a":
              case "A":
                if (this.direction !== "right") this.nextDirection = "left";
                break;
              case "ArrowRight":
              case "d":
              case "D":
                if (this.direction !== "left") this.nextDirection = "right";
                break;
            }
          }
        });

        // ç»‘å®šæŒ‰é’®æ§åˆ¶ï¼ˆä»…å•äººæ¨¡å¼ï¼‰
        if (this.mode !== "double") {
          document.getElementById("snake-up")?.addEventListener("click", () => {
            if (this.isGameOver) return;
            if (this.direction !== "down") this.nextDirection = "up";
          });
          document
            .getElementById("snake-down")
            ?.addEventListener("click", () => {
              if (this.isGameOver) return;
              if (this.direction !== "up") this.nextDirection = "down";
            });
          document
            .getElementById("snake-left")
            ?.addEventListener("click", () => {
              if (this.isGameOver) return;
              if (this.direction !== "right") this.nextDirection = "left";
            });
          document
            .getElementById("snake-right")
            ?.addEventListener("click", () => {
              if (this.isGameOver) return;
              if (this.direction !== "left") this.nextDirection = "right";
            });
        }

        // æ·»åŠ è§¦å±æ»‘åŠ¨æ§åˆ¶
        this.addTouchControls();
      }

      addTouchControls() {
        let touchStartX = 0;
        let touchStartY = 0;
        const minSwipeDistance = 30; // æœ€å°æ»‘åŠ¨è·ç¦»

        this.canvas.addEventListener(
          "touchstart",
          (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
          },
          { passive: false }
        );

        this.canvas.addEventListener(
          "touchend",
          (e) => {
            e.preventDefault();
            if (this.isGameOver) return;

            const touch = e.changedTouches[0];
            const touchEndX = touch.clientX;
            const touchEndY = touch.clientY;

            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;

            // åˆ¤æ–­æ»‘åŠ¨æ–¹å‘
            if (Math.abs(deltaX) > Math.abs(deltaY)) {
              // æ°´å¹³æ»‘åŠ¨
              if (Math.abs(deltaX) > minSwipeDistance) {
                if (deltaX > 0) {
                  // å‘å³æ»‘åŠ¨
                  if (this.mode === "double") {
                    if (this.direction1 !== "left")
                      this.nextDirection1 = "right";
                  } else {
                    if (this.direction !== "left") this.nextDirection = "right";
                  }
                } else {
                  // å‘å·¦æ»‘åŠ¨
                  if (this.mode === "double") {
                    if (this.direction1 !== "right")
                      this.nextDirection1 = "left";
                  } else {
                    if (this.direction !== "right") this.nextDirection = "left";
                  }
                }
              }
            } else {
              // å‚ç›´æ»‘åŠ¨
              if (Math.abs(deltaY) > minSwipeDistance) {
                if (deltaY > 0) {
                  // å‘ä¸‹æ»‘åŠ¨
                  if (this.mode === "double") {
                    if (this.direction1 !== "up") this.nextDirection1 = "down";
                  } else {
                    if (this.direction !== "up") this.nextDirection = "down";
                  }
                } else {
                  // å‘ä¸Šæ»‘åŠ¨
                  if (this.mode === "double") {
                    if (this.direction1 !== "down") this.nextDirection1 = "up";
                  } else {
                    if (this.direction !== "down") this.nextDirection = "up";
                  }
                }
              }
            }
          },
          { passive: false }
        );
      }

      update() {
        if (this.mode === "double") {
          this.updateDoubleModeLogic();
        } else {
          this.updateSingleModeLogic();
        }
      }

      updateSingleModeLogic() {
        // åœ¨æ›´æ–°å½“å‰è›‡ä½ç½®ä¹‹å‰ï¼Œä¿å­˜å½“å‰è›‡çš„ä½ç½®ä½œä¸º previousSnake
        this.previousSnake = JSON.parse(JSON.stringify(this.snake));

        // åº”ç”¨å¾…å®šçš„æ–¹å‘
        this.direction = this.nextDirection;

        const head = { ...this.snake[0] };

        switch (this.direction) {
          case "up":
            head.y -= this.gridSize;
            break;
          case "down":
            head.y += this.gridSize;
            break;
          case "left":
            head.x -= this.gridSize;
            break;
          case "right":
            head.x += this.gridSize;
            break;
        }

        if (
          head.x < 0 ||
          head.x >= this.canvas.width ||
          head.y < 0 ||
          head.y >= this.canvas.height ||
          this.snake.some(
            (segment) => segment.x === head.x && segment.y === head.y
          )
        ) {
          this.gameOver();
          return;
        }

        this.snake.unshift(head);

        if (head.x === this.food.x && head.y === this.food.y) {
          this.score += 10;
          const scoreElement = document.getElementById("snake-score");
          if (scoreElement) scoreElement.textContent = this.score.toString();
          this.food = this.generateFood();
          // é€Ÿåº¦è°ƒæ•´å½±å“é€»è¾‘æ›´æ–°é—´éš”
          this.logicSpeed = Math.max(50, this.logicSpeed - 2);
          // é‡æ–°è®¾ç½® setInterval ä»¥åº”ç”¨æ–°çš„é€Ÿåº¦
          clearInterval(this.logicInterval);
          this.logicInterval = setInterval(() => {
            if (!this.isGameOver) {
              this.update();
              this.lastLogicUpdateTime = Date.now(); // æ›´æ–°é€»è¾‘æ—¶é—´æˆ³
            }
          }, this.logicSpeed);
        } else {
          this.snake.pop();
        }
      }

      updateDoubleModeLogic() {
        // åœ¨æ›´æ–°å½“å‰è›‡ä½ç½®ä¹‹å‰ï¼Œä¿å­˜å½“å‰è›‡çš„ä½ç½®ä½œä¸º previousSnake
        this.previousSnake1 = JSON.parse(JSON.stringify(this.snake1));
        this.previousSnake2 = JSON.parse(JSON.stringify(this.snake2));

        // åº”ç”¨å¾…å®šçš„æ–¹å‘
        this.direction1 = this.nextDirection1;
        this.direction2 = this.nextDirection2;

        // æ›´æ–°ç©å®¶1
        const head1 = { ...this.snake1[0] };
        switch (this.direction1) {
          case "up":
            head1.y -= this.gridSize;
            break;
          case "down":
            head1.y += this.gridSize;
            break;
          case "left":
            head1.x -= this.gridSize;
            break;
          case "right":
            head1.x += this.gridSize;
            break;
        }

        // æ›´æ–°ç©å®¶2
        const head2 = { ...this.snake2[0] };
        switch (this.direction2) {
          case "up":
            head2.y -= this.gridSize;
            break;
          case "down":
            head2.y += this.gridSize;
            break;
          case "left":
            head2.x -= this.gridSize;
            break;
          case "right":
            head2.x += this.gridSize;
            break;
        }

        // æ£€æŸ¥ç¢°æ’
        const player1Dead = this.checkCollision(
          head1,
          this.snake1,
          this.snake2
        );
        const player2Dead = this.checkCollision(
          head2,
          this.snake2,
          this.snake1
        );

        if (player1Dead && player2Dead) {
          this.gameOver("å¹³å±€ï¼");
          return;
        } else if (player1Dead) {
          this.gameOver("ç©å®¶2è·èƒœï¼");
          return;
        } else if (player2Dead) {
          this.gameOver("ç©å®¶1è·èƒœï¼");
          return;
        }

        // ç§»åŠ¨è›‡
        this.snake1.unshift(head1);
        this.snake2.unshift(head2);

        // æ£€æŸ¥é£Ÿç‰©
        let foodEaten = false;
        if (head1.x === this.food.x && head1.y === this.food.y) {
          this.score1 += 10;
          foodEaten = true;
        } else {
          this.snake1.pop();
        }

        if (head2.x === this.food.x && head2.y === this.food.y) {
          this.score2 += 10;
          foodEaten = true;
        } else {
          this.snake2.pop();
        }

        if (foodEaten) {
          this.food = this.generateFood();
          const scoreElement = document.getElementById("snake-score");
          if (scoreElement)
            scoreElement.textContent = `ç©å®¶1: ${this.score1} | ç©å®¶2: ${this.score2}`;
        }
      }

      checkCollision(head, ownSnake, otherSnake) {
        // æ£€æŸ¥è¾¹ç•Œç¢°æ’
        if (
          head.x < 0 ||
          head.x >= this.canvas.width ||
          head.y < 0 ||
          head.y >= this.canvas.height
        ) {
          return true;
        }

        // æ£€æŸ¥è‡ªèº«ç¢°æ’
        // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦ä»ç¬¬äºŒä¸ªæ®µå¼€å§‹æ£€æŸ¥ï¼Œå› ä¸ºå¤´éƒ¨æ€»æ˜¯ä¼šå’Œå®ƒè‡ªå·±é‡å 
        if (
          ownSnake
            .slice(1)
            .some((segment) => segment.x === head.x && segment.y === head.y)
        ) {
          return true;
        }

        // æ£€æŸ¥ä¸å¯¹æ–¹è›‡çš„ç¢°æ’
        if (
          otherSnake.some(
            (segment) => segment.x === head.x && segment.y === head.y
          )
        ) {
          return true;
        }

        return false;
      }

      // æ¸²æŸ“å‡½æ•°ï¼Œç”± requestAnimationFrame è°ƒç”¨
      render() {
        if (this.isGameOver) {
          cancelAnimationFrame(this.animationFrameId);
          return;
        }

        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

        const currentTime = Date.now();
        // è®¡ç®—æ’å€¼è¿›åº¦ (0 åˆ° 1)
        // progress = (å½“å‰æ—¶é—´ - ä¸Šæ¬¡é€»è¾‘æ›´æ–°æ—¶é—´) / é€»è¾‘æ›´æ–°é—´éš”
        let progress =
          (currentTime - this.lastLogicUpdateTime) / this.logicSpeed;
        progress = Math.min(1, Math.max(0, progress)); // ç¡®ä¿è¿›åº¦åœ¨ 0 åˆ° 1 ä¹‹é—´

        if (this.mode === "double") {
          this.drawInterpolatedSnake(
            this.snake1,
            this.previousSnake1,
            progress,
            "#2E7D32",
            "#4CAF50"
          ); // ç©å®¶1 (ç»¿è‰²)
          this.drawInterpolatedSnake(
            this.snake2,
            this.previousSnake2,
            progress,
            "#1565C0",
            "#2196F3"
          ); // ç©å®¶2 (è“è‰²)
        } else {
          this.drawInterpolatedSnake(
            this.snake,
            this.previousSnake,
            progress,
            "#2E7D32",
            "#4CAF50"
          ); // å•äººæ¨¡å¼ (ç»¿è‰²)
        }

        // ç»˜åˆ¶é£Ÿç‰© (é£Ÿç‰©ä¸éœ€è¦æ’å€¼)
        this.ctx.fillStyle = "#FF5722";
        this.ctx.fillRect(
          this.food.x,
          this.food.y,
          this.gridSize - 1,
          this.gridSize - 1
        );

        // è¯·æ±‚ä¸‹ä¸€å¸§åŠ¨ç”»
        this.animationFrameId = requestAnimationFrame(this.render.bind(this));
      }

      // è¾…åŠ©å‡½æ•°ï¼šç»˜åˆ¶æ’å€¼åçš„è›‡
      drawInterpolatedSnake(
        snake,
        previousSnake,
        progress,
        headColor,
        bodyColor
      ) {
        snake.forEach((segment, index) => {
          let interpolatedX, interpolatedY;

          // å¯¹äºå·²ç»å­˜åœ¨çš„è›‡èº«æ®µï¼Œè¿›è¡Œæ’å€¼
          if (index < previousSnake.length) {
            const prevSegment = previousSnake[index];
            interpolatedX =
              prevSegment.x + (segment.x - prevSegment.x) * progress;
            interpolatedY =
              prevSegment.y + (segment.y - prevSegment.y) * progress;
          } else {
            // å¯¹äºæ–°å¢åŠ çš„è›‡å¤´ï¼ˆåƒé£Ÿç‰©åï¼‰ï¼Œç›´æ¥ç»˜åˆ¶åœ¨å½“å‰ä½ç½®
            // ç†è®ºä¸Šä¹Ÿå¯ä»¥æ’å€¼ï¼Œä½†éœ€è¦æ›´å¤æ‚çš„é€»è¾‘æ¥è¿½è¸ªæ–°æ®µçš„â€œå‰ä¸€ä¸ªâ€ä½ç½®
            interpolatedX = segment.x;
            interpolatedY = segment.y;
          }

          this.ctx.fillStyle = index === 0 ? headColor : bodyColor; // å¤´éƒ¨å’Œèº«ä½“é¢œè‰²ä¸åŒ
          this.ctx.fillRect(
            interpolatedX,
            interpolatedY,
            this.gridSize - 1,
            this.gridSize - 1
          );
        });
      }

      gameOver(message) {
        this.stop(); // åœæ­¢æ‰€æœ‰å¾ªç¯

        this.isGameOver = true;

        let finalMessage;
        if (this.mode === "double") {
          finalMessage =
            message ||
            `æ¸¸æˆç»“æŸï¼ç©å®¶1å¾—åˆ†: ${this.score1}, ç©å®¶2å¾—åˆ†: ${this.score2}`;
        } else {
          finalMessage = `æ¸¸æˆç»“æŸï¼å¾—åˆ†: ${this.score}`;
        }

        // æ˜¾ç¤ºæ¸¸æˆç»“æŸå¼¹çª—ï¼Œè¯¢é—®æ˜¯å¦é‡æ–°å¼€å§‹
        setTimeout(() => {
          const restart = confirm(`${finalMessage}\n\næ˜¯å¦é‡æ–°å¼€å§‹æ¸¸æˆï¼Ÿ`);
          if (restart) {
            this.restart();
          } else {
            // è¿”å›æ¨¡å¼é€‰æ‹©
            this.backToModeSelection();
          }
        }, 100);
      }

      restart() {
        // é‡ç½®æ¸¸æˆçŠ¶æ€
        this.isGameOver = false;
        this.stop(); // ç¡®ä¿åœæ­¢æ‰€æœ‰æ—§çš„å¾ªç¯

        if (this.mode === "double") {
          this.snake1 = [{ x: 100, y: 200 }];
          this.snake2 = [{ x: 500, y: 200 }];
          this.direction1 = "right";
          this.direction2 = "left";
          this.nextDirection1 = "right";
          this.nextDirection2 = "left";
          this.score1 = 0;
          this.score2 = 0;
          this.previousSnake1 = JSON.parse(JSON.stringify(this.snake1));
          this.previousSnake2 = JSON.parse(JSON.stringify(this.snake2));
          const scoreElement = document.getElementById("snake-score");
          if (scoreElement) scoreElement.textContent = "ç©å®¶1: 0 | ç©å®¶2: 0";
        } else {
          this.snake = [{ x: 200, y: 200 }];
          this.direction = "right";
          this.nextDirection = "right";
          this.score = 0;
          this.previousSnake = JSON.parse(JSON.stringify(this.snake));
          const scoreElement = document.getElementById("snake-score");
          if (scoreElement) scoreElement.textContent = "0";
        }

        this.food = this.generateFood();
        this.logicSpeed = 150;
        this.start();
      }

      backToModeSelection() {
        this.stop();
        document.getElementById("snake-game-area")?.classList.add("hidden");
        document
          .getElementById("snake-mode-selection")
          ?.classList.remove("hidden");
      }

      start() {
        this.lastLogicUpdateTime = Date.now(); // è®°å½•é¦–æ¬¡é€»è¾‘æ›´æ–°æ—¶é—´
        this.logicInterval = setInterval(() => {
          if (!this.isGameOver) {
            this.update(); // æ‰§è¡Œé€»è¾‘æ›´æ–°
            this.lastLogicUpdateTime = Date.now(); // æ›´æ–°é€»è¾‘æ›´æ–°æ—¶é—´æˆ³
          }
        }, this.logicSpeed);

        // å¯åŠ¨æ¸²æŸ“å¾ªç¯
        this.animationFrameId = requestAnimationFrame(this.render.bind(this));
      }

      stop() {
        if (this.logicInterval) {
          clearInterval(this.logicInterval);
          this.logicInterval = null;
        }
        if (this.animationFrameId) {
          cancelAnimationFrame(this.animationFrameId);
          this.animationFrameId = null;
        }
      }
    }

    // äº”å­æ£‹æ¸¸æˆç±»
    class GomokuGame {
      constructor(canvas, mode) {
        this.canvas = canvas;
        this.ctx = canvas.getContext("2d");
        this.mode = mode;
        this.boardSize = 15;
        this.cellSize = Math.floor(
          (Math.min(canvas.width, canvas.height) - 40) / this.boardSize
        );
        this.board = Array(this.boardSize)
          .fill(null)
          .map(() => Array(this.boardSize).fill(null));
        this.currentPlayer = "black";
        this.gameOver = false;
        this.aiThinking = false; // AIæ€è€ƒçŠ¶æ€æ ‡è®°

        this.drawBoard();
        this.bindEvents();
      }

      drawBoard() {
        // æ¸…ç©ºç”»å¸ƒ
        this.ctx.fillStyle = "#F4A460";
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

        this.ctx.strokeStyle = "#000";
        this.ctx.lineWidth = 1;

        const margin = 20; // è¾¹è·

        // ç»˜åˆ¶æ¨ªçº¿
        for (let i = 0; i < this.boardSize; i++) {
          this.ctx.beginPath();
          this.ctx.moveTo(margin, margin + i * this.cellSize);
          this.ctx.lineTo(
            margin + (this.boardSize - 1) * this.cellSize,
            margin + i * this.cellSize
          );
          this.ctx.stroke();
        }

        // ç»˜åˆ¶ç«–çº¿
        for (let i = 0; i < this.boardSize; i++) {
          this.ctx.beginPath();
          this.ctx.moveTo(margin + i * this.cellSize, margin);
          this.ctx.lineTo(
            margin + i * this.cellSize,
            margin + (this.boardSize - 1) * this.cellSize
          );
          this.ctx.stroke();
        }

        // ç»˜åˆ¶æ˜Ÿä½
        const stars = [3, 7, 11];
        for (let i of stars) {
          for (let j of stars) {
            this.drawStar(i, j, margin);
          }
        }
      }

      drawStar(x, y, margin) {
        this.ctx.fillStyle = "#000";
        this.ctx.beginPath();
        this.ctx.arc(
          margin + x * this.cellSize,
          margin + y * this.cellSize,
          3,
          0,
          2 * Math.PI
        );
        this.ctx.fill();
      }

      drawStar(x, y) {
        this.ctx.fillStyle = "#000";
        this.ctx.beginPath();
        this.ctx.arc(
          (x + 1) * this.cellSize,
          (y + 1) * this.cellSize,
          2,
          0,
          2 * Math.PI
        );
        this.ctx.fill();
      }

      drawPiece(x, y, color) {
        const margin = 20;
        const centerX = margin + x * this.cellSize;
        const centerY = margin + y * this.cellSize;
        const radius = this.cellSize * 0.4;

        this.ctx.fillStyle = color;
        this.ctx.beginPath();
        this.ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
        this.ctx.fill();

        this.ctx.strokeStyle = color === "black" ? "#333" : "#666";
        this.ctx.lineWidth = 2;
        this.ctx.stroke();
      }

      bindEvents() {
        // å¤„ç†ç‚¹å‡»å’Œè§¦å±äº‹ä»¶çš„é€šç”¨å‡½æ•°
        const handleInteraction = (clientX, clientY) => {
          if (this.gameOver) return;

          // å•äººæ¨¡å¼ä¸‹ï¼Œå¦‚æœå½“å‰æ˜¯ç™½å­å›åˆï¼ˆAIå›åˆï¼‰æˆ–AIæ­£åœ¨æ€è€ƒï¼Œç¦æ­¢ç©å®¶æ“ä½œ
          if (
            this.mode === "single" &&
            (this.currentPlayer === "white" || this.aiThinking)
          ) {
            console.log("AIå›åˆï¼Œè¯·ç­‰å¾…AIä¸‹æ£‹");
            return;
          }

          const rect = this.canvas.getBoundingClientRect();
          const margin = 20;

          // è€ƒè™‘Canvasçš„ç¼©æ”¾æ¯”ä¾‹
          const scaleX = this.canvas.width / rect.width;
          const scaleY = this.canvas.height / rect.height;

          const x = Math.round(
            ((clientX - rect.left) * scaleX - margin) / this.cellSize
          );
          const y = Math.round(
            ((clientY - rect.top) * scaleY - margin) / this.cellSize
          );

          if (
            x >= 0 &&
            x < this.boardSize &&
            y >= 0 &&
            y < this.boardSize &&
            !this.board[y][x]
          ) {
            this.makeMove(x, y);
          }
        };

        // é¼ æ ‡ç‚¹å‡»äº‹ä»¶
        this.canvas.addEventListener("click", (e) => {
          handleInteraction(e.clientX, e.clientY);
        });

        // è§¦å±äº‹ä»¶æ”¯æŒ
        this.canvas.addEventListener(
          "touchstart",
          (e) => {
            e.preventDefault(); // é˜²æ­¢é¡µé¢æ»šåŠ¨
            if (e.touches.length === 1) {
              const touch = e.touches[0];
              // æ·»åŠ è§¦å±åé¦ˆ
              this.showTouchFeedback(touch.clientX, touch.clientY);
              handleInteraction(touch.clientX, touch.clientY);
            }
          },
          { passive: false }
        );

        // é˜²æ­¢è§¦å±æ—¶çš„ä¸Šä¸‹æ–‡èœå•
        this.canvas.addEventListener("contextmenu", (e) => {
          e.preventDefault();
        });

        document
          .getElementById("gomoku-restart")
          ?.addEventListener("click", () => {
            this.restart();
          });
      }

      // æ˜¾ç¤ºè§¦å±åé¦ˆ
      showTouchFeedback(clientX, clientY) {
        const rect = this.canvas.getBoundingClientRect();
        const margin = 20;

        // è€ƒè™‘Canvasçš„ç¼©æ”¾æ¯”ä¾‹
        const scaleX = this.canvas.width / rect.width;
        const scaleY = this.canvas.height / rect.height;

        const x = Math.round(
          ((clientX - rect.left) * scaleX - margin) / this.cellSize
        );
        const y = Math.round(
          ((clientY - rect.top) * scaleY - margin) / this.cellSize
        );

        if (
          x >= 0 &&
          x < this.boardSize &&
          y >= 0 &&
          y < this.boardSize &&
          !this.board[y][x]
        ) {
          // ç»˜åˆ¶ä¸´æ—¶çš„åŠé€æ˜åœ†åœˆä½œä¸ºåé¦ˆ
          const canvasX = margin + x * this.cellSize;
          const canvasY = margin + y * this.cellSize;

          this.ctx.save();
          this.ctx.globalAlpha = 0.3;
          this.ctx.fillStyle = this.currentPlayer === "black" ? "#000" : "#fff";
          this.ctx.beginPath();
          this.ctx.arc(canvasX, canvasY, this.cellSize / 2 - 2, 0, 2 * Math.PI);
          this.ctx.fill();
          this.ctx.restore();

          // 200msåæ¸…é™¤åé¦ˆ
          setTimeout(() => {
            this.drawBoard();
            this.redrawAllPieces();
          }, 200);
        }
      }

      // é‡æ–°ç»˜åˆ¶æ‰€æœ‰æ£‹å­
      redrawAllPieces() {
        for (let y = 0; y < this.boardSize; y++) {
          for (let x = 0; x < this.boardSize; x++) {
            if (this.board[y][x]) {
              this.drawPiece(x, y, this.board[y][x]);
            }
          }
        }
      }

      makeMove(x, y) {
        this.board[y][x] = this.currentPlayer;
        this.drawPiece(x, y, this.currentPlayer);

        if (this.checkWin(x, y)) {
          this.gameOver = true;
          setTimeout(() => {
            alert(`${this.currentPlayer === "black" ? "é»‘å­" : "ç™½å­"}è·èƒœï¼`);
          }, 100);
          return;
        }

        this.currentPlayer = this.currentPlayer === "black" ? "white" : "black";
        const currentPlayerElement = document.getElementById("current-player");
        if (currentPlayerElement) {
          currentPlayerElement.textContent =
            this.currentPlayer === "black" ? "é»‘å­" : "ç™½å­";
        }

        if (this.mode === "single" && this.currentPlayer === "white") {
          // è®¾ç½®AIæ€è€ƒçŠ¶æ€
          this.aiThinking = true;

          // æ›´æ–°UIæ˜¾ç¤ºAIæ­£åœ¨æ€è€ƒ
          const currentPlayerElement =
            document.getElementById("current-player");
          if (currentPlayerElement) {
            currentPlayerElement.textContent = "AIæ€è€ƒä¸­...";
          }

          setTimeout(() => {
            this.makeAIMove();
            this.aiThinking = false; // AIæ€è€ƒå®Œæˆ

            // æ¢å¤UIæ˜¾ç¤º
            if (currentPlayerElement) {
              currentPlayerElement.textContent =
                this.currentPlayer === "black" ? "é»‘å­" : "ç™½å­";
            }
          }, 800); // å¢åŠ æ€è€ƒæ—¶é—´ï¼Œè®©ç”¨æˆ·æ„Ÿå—åˆ°AIåœ¨æ€è€ƒ
        }
      }

      makeAIMove() {
        // åŸºäºCè¯­è¨€AIé€»è¾‘çš„æ™ºèƒ½AI
        const scoreBoard = Array(this.boardSize)
          .fill(null)
          .map(() => Array(this.boardSize).fill(0));

        // è¯„ä¼°æ¯ä¸ªç©ºä½çš„åˆ†æ•°
        for (let y = 0; y < this.boardSize; y++) {
          for (let x = 0; x < this.boardSize; x++) {
            if (!this.board[y][x]) {
              scoreBoard[y][x] = this.evaluatePosition(x, y);
            }
          }
        }

        // æ‰¾åˆ°æœ€é«˜åˆ†çš„ä½ç½®
        let maxScore = -1;
        let bestMoves = [];

        for (let y = 0; y < this.boardSize; y++) {
          for (let x = 0; x < this.boardSize; x++) {
            if (!this.board[y][x] && scoreBoard[y][x] > maxScore) {
              maxScore = scoreBoard[y][x];
              bestMoves = [[x, y]];
            } else if (!this.board[y][x] && scoreBoard[y][x] === maxScore) {
              bestMoves.push([x, y]);
            }
          }
        }

        if (bestMoves.length > 0) {
          const [x, y] =
            bestMoves[Math.floor(Math.random() * bestMoves.length)];
          this.makeMove(x, y);
        }
      }

      // è¯„ä¼°ä½ç½®åˆ†æ•°çš„æ ¸å¿ƒå‡½æ•°
      evaluatePosition(x, y) {
        let score = 0;

        // åŸºç¡€ä¸­å¿ƒä½ç½®åŠ åˆ†
        const centerX = Math.floor(this.boardSize / 2);
        const centerY = Math.floor(this.boardSize / 2);
        const distanceFromCenter =
          Math.abs(x - centerX) + Math.abs(y - centerY);
        score += Math.max(0, 10 - distanceFromCenter);

        // æ£€æŸ¥å››ä¸ªæ–¹å‘ï¼šæ°´å¹³ã€å‚ç›´ã€ä¸»å¯¹è§’çº¿ã€å‰¯å¯¹è§’çº¿
        const directions = [
          [1, 0], // æ°´å¹³
          [0, 1], // å‚ç›´
          [1, 1], // ä¸»å¯¹è§’çº¿
          [1, -1], // å‰¯å¯¹è§’çº¿
        ];

        for (const [dx, dy] of directions) {
          // æ£€æŸ¥AI(ç™½å­)çš„æœºä¼š
          score += this.evaluateDirection(x, y, dx, dy, "white");
          // æ£€æŸ¥ç©å®¶(é»‘å­)çš„å¨èƒå¹¶é˜²å®ˆ
          score += this.evaluateDirection(x, y, dx, dy, "black") * 1.1; // é˜²å®ˆç¨å¾®é‡è¦ä¸€äº›
        }

        return score;
      }

      // è¯„ä¼°ç‰¹å®šæ–¹å‘çš„åˆ†æ•°
      evaluateDirection(x, y, dx, dy, player) {
        let score = 0;

        // æ£€æŸ¥è¯¥ä½ç½®åœ¨è¿™ä¸ªæ–¹å‘ä¸Šçš„æ£‹å‹
        const line = this.getLine(x, y, dx, dy, 9); // è·å–9ä¸ªä½ç½®çš„çº¿æ®µ
        const centerIndex = 4; // ä¸­å¿ƒä½ç½®ç´¢å¼•

        // æ¨¡æ‹Ÿåœ¨æ­¤ä½ç½®ä¸‹å­
        line[centerIndex] = player;

        // æ£€æŸ¥å„ç§æ£‹å‹å¹¶ç»™åˆ†
        score += this.checkPatterns(line, player);

        return score;
      }

      // è·å–æŒ‡å®šæ–¹å‘çš„çº¿æ®µ
      getLine(x, y, dx, dy, length) {
        const line = new Array(length).fill(null);
        const startIndex = Math.floor(length / 2);

        for (let i = 0; i < length; i++) {
          const offset = i - startIndex;
          const nx = x + offset * dx;
          const ny = y + offset * dy;

          if (
            nx >= 0 &&
            nx < this.boardSize &&
            ny >= 0 &&
            ny < this.boardSize
          ) {
            line[i] = this.board[ny][nx];
          } else {
            line[i] = "boundary"; // è¾¹ç•Œæ ‡è®°
          }
        }

        return line;
      }

      // æ£€æŸ¥æ£‹å‹æ¨¡å¼å¹¶ç»™åˆ†
      checkPatterns(line, player) {
        let score = 0;
        const opponent = player === "black" ? "white" : "black";

        // è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä¾¿äºæ¨¡å¼åŒ¹é…
        const lineStr = line
          .map((cell) => {
            if (cell === player) return "O";
            if (cell === opponent) return "X";
            if (cell === null) return "-";
            return "B"; // boundary
          })
          .join("");

        // äº”è¿ - å¿…èƒœ
        if (lineStr.includes("OOOOO")) {
          score += 100000;
        }

        // æ´»å›› - ä¸¤ç«¯éƒ½èƒ½æˆäº”
        if (lineStr.includes("-OOOO-")) {
          score += 10000;
        }

        // å†²å›› - ä¸€ç«¯èƒ½æˆäº”
        if (
          lineStr.includes("XOOOO-") ||
          lineStr.includes("-OOOOX") ||
          lineStr.includes("BOOOO-") ||
          lineStr.includes("-OOOOB")
        ) {
          score += 1000;
        }

        // æ´»ä¸‰ - ä¸¤ç«¯éƒ½èƒ½æˆäº”çš„ä¸‰å­
        if (lineStr.includes("-OOO-") || lineStr.includes("--OOO--")) {
          score += 1000;
        }

        // çœ ä¸‰ - ä¸€ç«¯è¢«å µçš„ä¸‰å­
        if (
          lineStr.includes("XOOO-") ||
          lineStr.includes("-OOOX") ||
          lineStr.includes("BOOO-") ||
          lineStr.includes("-OOOB")
        ) {
          score += 100;
        }

        // æ´»äºŒ - ä¸¤ç«¯éƒ½èƒ½å‘å±•çš„äºŒå­
        if (lineStr.includes("-OO-") || lineStr.includes("--OO--")) {
          score += 100;
        }

        // çœ äºŒ - ä¸€ç«¯è¢«å µçš„äºŒå­
        if (
          lineStr.includes("XOO-") ||
          lineStr.includes("-OOX") ||
          lineStr.includes("BOO-") ||
          lineStr.includes("-OOB")
        ) {
          score += 10;
        }

        // æ´»ä¸€ - å•å­å‘¨å›´æœ‰ç©ºé—´
        if (lineStr.includes("-O-")) {
          score += 10;
        }

        // ç‰¹æ®Šé˜²å®ˆæ¨¡å¼ - é˜²æ­¢å¯¹æ–¹å½¢æˆå±é™©æ£‹å‹
        if (player === "black") {
          // å½“æˆ‘ä»¬åœ¨è¯„ä¼°é˜²å®ˆé»‘å­æ—¶
          // é˜²å››è¿
          if (lineStr.includes("-XXXX-")) {
            score += 9000; // é«˜ä¼˜å…ˆçº§é˜²å®ˆ
          }
          if (lineStr.includes("BXXXX-") || lineStr.includes("-XXXXB")) {
            score += 5000;
          }

          // é˜²æ´»ä¸‰
          if (lineStr.includes("-XXX-")) {
            score += 3000;
          }

          // é˜²è·³æ´»ä¸‰
          if (lineStr.includes("-XX-X-") || lineStr.includes("-X-XX-")) {
            score += 2000;
          }
        }

        return score;
      }

      checkWin(x, y) {
        const directions = [
          [
            [0, 1],
            [0, -1],
          ],
          [
            [1, 0],
            [-1, 0],
          ],
          [
            [1, 1],
            [-1, -1],
          ],
          [
            [1, -1],
            [-1, 1],
          ],
        ];

        const player = this.board[y][x];

        for (const [dir1, dir2] of directions) {
          let count = 1;

          for (let i = 1; i <= 4; i++) {
            const newX = x + dir1[0] * i;
            const newY = y + dir1[1] * i;
            if (
              newX < 0 ||
              newX >= this.boardSize ||
              newY < 0 ||
              newY >= this.boardSize ||
              this.board[newY][newX] !== player
            )
              break;
            count++;
          }

          for (let i = 1; i <= 4; i++) {
            const newX = x + dir2[0] * i;
            const newY = y + dir2[1] * i;
            if (
              newX < 0 ||
              newX >= this.boardSize ||
              newY < 0 ||
              newY >= this.boardSize ||
              this.board[newY][newX] !== player
            )
              break;
            count++;
          }

          if (count >= 5) return true;
        }

        return false;
      }

      restart() {
        this.board = Array(this.boardSize)
          .fill(null)
          .map(() => Array(this.boardSize).fill(null));
        this.currentPlayer = "black";
        this.gameOver = false;
        const currentPlayerElement = document.getElementById("current-player");
        if (currentPlayerElement) {
          currentPlayerElement.textContent = "é»‘å­";
        }
        this.drawBoard();
      }

      start() {
        // æ¸¸æˆå·²ç»å¼€å§‹ï¼Œä¸éœ€è¦é¢å¤–æ“ä½œ
      }

      stop() {
        this.gameOver = true;
      }
    }

    // åˆå§‹åŒ–æ¸¸æˆåŠŸèƒ½
    var initializeGames = function () {
      // è´ªåƒè›‡æ¨¡å¼é€‰æ‹©
      document.getElementById("snake-single")?.addEventListener("click", () => {
        startSnakeGame("single");
      });

      document.getElementById("snake-double")?.addEventListener("click", () => {
        startSnakeGame("double");
      });

      document
        .getElementById("snake-challenge")
        ?.addEventListener("click", () => {
          startSnakeGame("challenge");
        });

      // äº”å­æ£‹æ¨¡å¼é€‰æ‹©
      document
        .getElementById("gomoku-single")
        ?.addEventListener("click", () => {
          startGomokuGame("single");
        });

      document
        .getElementById("gomoku-double")
        ?.addEventListener("click", () => {
          startGomokuGame("double");
        });

      // æ¸¸æˆå†…è¿”å›æŒ‰é’®
      document.getElementById("snake-back")?.addEventListener("click", () => {
        stopCurrentGame();
        document.getElementById("snake-game-area")?.classList.add("hidden");
        document
          .getElementById("snake-mode-selection")
          ?.classList.remove("hidden");
      });

      document.getElementById("gomoku-back")?.addEventListener("click", () => {
        stopCurrentGame();
        document.getElementById("gomoku-game-area")?.classList.add("hidden");
        document
          .getElementById("gomoku-mode-selection")
          ?.classList.remove("hidden");
      });
    };

    var startSnakeGame = function (mode) {
      stopCurrentGame();

      // éšè—æ¨¡å¼é€‰æ‹©ï¼Œæ˜¾ç¤ºæ¸¸æˆåŒºåŸŸ
      document.getElementById("snake-mode-selection")?.classList.add("hidden");
      const gameArea = document.getElementById("snake-game-area");
      const canvas = document.getElementById("snake-canvas");

      if (gameArea && canvas) {
        gameArea.classList.remove("hidden");

        // è®¾ç½®æ§åˆ¶è¯´æ˜å’Œåˆ†æ•°æ˜¾ç¤º
        const scoreElement = document.getElementById("snake-score");
        const controlInfo = document.getElementById("snake-control-info");
        const buttonsArea = document.getElementById("snake-buttons");

        if (mode === "double") {
          if (scoreElement) scoreElement.textContent = "ç©å®¶1: 0 | ç©å®¶2: 0";
          if (controlInfo)
            controlInfo.innerHTML =
              "ğŸ® ç©å®¶1: WASDé”®æ§åˆ¶ (ç»¿è›‡) | ç©å®¶2: æ–¹å‘é”®æ§åˆ¶ (è“è›‡)";
          if (buttonsArea) buttonsArea.style.display = "none"; // éšè—æŒ‰é’®æ§åˆ¶
        } else {
          if (scoreElement) scoreElement.textContent = "0";
          if (controlInfo)
            controlInfo.innerHTML = "ğŸ® ä½¿ç”¨ WASD æˆ–æ–¹å‘é”®æ§åˆ¶ï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®";
          if (buttonsArea) buttonsArea.style.display = "flex"; // æ˜¾ç¤ºæŒ‰é’®æ§åˆ¶
        }

        currentGame = new SnakeGame(canvas, mode);
        currentGame.start();
      }
    };

    var startGomokuGame = function (mode) {
      stopCurrentGame();

      // éšè—æ¨¡å¼é€‰æ‹©ï¼Œæ˜¾ç¤ºæ¸¸æˆåŒºåŸŸ
      document.getElementById("gomoku-mode-selection")?.classList.add("hidden");
      const gameArea = document.getElementById("gomoku-game-area");
      const canvas = document.getElementById("gomoku-canvas");

      if (gameArea && canvas) {
        gameArea.classList.remove("hidden");
        // é‡ç½®ç©å®¶æ˜¾ç¤º
        const currentPlayerElement = document.getElementById("current-player");
        if (currentPlayerElement) currentPlayerElement.textContent = "é»‘å­";

        currentGame = new GomokuGame(canvas, mode);
        currentGame.start();
      }
    };

    var stopCurrentGame = function () {
      if (currentGame) {
        currentGame.stop();
        currentGame = null;
      }
    };

    // åˆå§‹åŒ–çˆ¬è™«åŠŸèƒ½
    var initializeScrapers = function () {
      const vegetableForm = document.getElementById("vegetable-form");
      const vegetableResults = document.getElementById("vegetable-results");
      const fetchWeatherButton = document.getElementById("fetch-weather");
      const weatherResults = document.getElementById("weather-results");
      const provinceIdInput = document.getElementById("province-id");

      const pauseVegetableButton = document.getElementById("pause-vegetable");
      const resumeVegetableButton = document.getElementById("resume-vegetable");
      const pauseWeatherButton = document.getElementById("pause-weather");
      const resumeWeatherButton = document.getElementById("resume-weather");

      // è”¬èœä»·æ ¼çˆ¬å–
      vegetableForm?.addEventListener("submit", async (event) => {
        event.preventDefault();
        vegetableResults.innerHTML =
          '<p class="text-gray-500 dark:text-gray-400 text-center loading">ğŸ”„ æ­£åœ¨çˆ¬å–è”¬èœä»·æ ¼æ•°æ®...</p>';
        hideButton(vegetableForm.querySelector('button[type="submit"]'));
        showButton(pauseVegetableButton);
        hideButton(resumeVegetableButton);

        isVegetablePaused = false;
        vegetableAbortController = new AbortController();
        const signal = vegetableAbortController.signal;

        currentVegetablePage = parseInt(
          document.getElementById("start-page").value
        );
        const endPage = parseInt(document.getElementById("end-page").value);

        let allVegetableData = [];

        const scrapeVegetablePage = async (page) => {
          if (isVegetablePaused) return;
          if (signal.aborted) {
            vegetableResults.innerHTML =
              '<p class="text-red-500 text-center">è”¬èœçˆ¬å–å·²å–æ¶ˆ</p>';
            hideButton(pauseVegetableButton);
            showButton(vegetableForm.querySelector('button[type="submit"]'));
            return;
          }

          try {
            const response = await fetch("/api/vegetable-scraper", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ startPage: page, endPage: page }),
              signal: signal,
            });

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(errorData.details || "Unknown error");
            }

            const result = await response.json();
            return result.data;
          } catch (error) {
            if (error.name === "AbortError") {
              vegetableResults.innerHTML =
                '<p class="text-yellow-500 text-center">è”¬èœçˆ¬å–å·²æš‚åœ</p>';
              return null;
            } else {
              console.error("Error fetching vegetable data:", error);
              vegetableResults.innerHTML = `<p class="text-red-500 text-center">è·å–è”¬èœæ•°æ®å‡ºé”™: ${error.message}</p>`;
              hideButton(pauseVegetableButton);
              hideButton(resumeVegetableButton);
              showButton(vegetableForm.querySelector('button[type="submit"]'));
              throw error;
            }
          }
        };

        const runVegetableScraping = async () => {
          while (currentVegetablePage <= endPage && !isVegetablePaused) {
            const data = await scrapeVegetablePage(currentVegetablePage);
            if (data === null) {
              break;
            }
            allVegetableData = allVegetableData.concat(data);
            currentVegetablePage++;

            if (allVegetableData.length > 0) {
              let html = `<div class='mb-4'><h3 class='text-xl font-bold text-gray-800 dark:text-gray-200 mb-2'>ğŸ¥¬ çˆ¬å–ç»“æœ (å…± ${allVegetableData.length} æ¡)</h3></div>`;
              html += "<div class='space-y-3'>";
              allVegetableData.forEach((item, index) => {
                html += `
                <div class='p-4 bg-white dark:bg-gray-600 rounded-lg border border-gray-200 dark:border-gray-500 hover:shadow-md transition-shadow'>
                  <div class='flex items-start justify-between'>
                    <div class='flex-1'>
                      <h4 class='font-bold text-lg text-green-600 dark:text-green-400 mb-2'>${item.prodName}</h4>
                      <div class='grid grid-cols-2 md:grid-cols-3 gap-2 text-sm'>
                        <div><span class='text-gray-500'>æœ€ä½ä»·:</span> <span class='font-semibold text-red-600'>${item.lowPrice}</span></div>
                        <div><span class='text-gray-500'>æœ€é«˜ä»·:</span> <span class='font-semibold text-red-600'>${item.highPrice}</span></div>
                        <div><span class='text-gray-500'>å‡ä»·:</span> <span class='font-semibold text-blue-600'>${item.avgPrice}</span></div>
                        <div><span class='text-gray-500'>è§„æ ¼:</span> ${item.specInfo || "-"}</div>
                        <div><span class='text-gray-500'>äº§åœ°:</span> ${item.place || "-"}</div>
                        <div><span class='text-gray-500'>å•ä½:</span> ${item.unitInfo || "-"}</div>
                      </div>
                      <div class='mt-2 text-xs text-gray-400'>æ—¥æœŸ: ${item.pubDate}</div>
                    </div>
                    <div class='ml-4 text-xs text-gray-400'>#${index + 1}</div>
                  </div>
                </div>
              `;
              });
              html += "</div>";
              vegetableResults.innerHTML = html;
            } else {
              vegetableResults.innerHTML =
                "<div class='text-center py-8'><div class='text-4xl mb-2'>ğŸ¤·â€â™‚ï¸</div><p class='text-gray-500'>æœªæ‰¾åˆ°è”¬èœæ•°æ®</p></div>";
            }
            await new Promise((resolve) => setTimeout(resolve, 1000));
          }

          if (!isVegetablePaused) {
            hideButton(pauseVegetableButton);
            hideButton(resumeVegetableButton);
            showButton(vegetableForm.querySelector('button[type="submit"]'));
          }
        };

        runVegetableScraping();
      });

      // å¤©æ°”æ•°æ®çˆ¬å–
      fetchWeatherButton?.addEventListener("click", async () => {
        weatherResults.innerHTML =
          '<p class="text-gray-500 dark:text-gray-400 text-center loading">ğŸŒ¤ï¸ æ­£åœ¨è·å–å¤©æ°”æ•°æ®...</p>';
        hideButton(fetchWeatherButton);
        showButton(pauseWeatherButton);
        hideButton(resumeWeatherButton);

        isWeatherPaused = false;
        weatherAbortController = new AbortController();
        const signal = weatherAbortController.signal;

        const provinceId = provinceIdInput.value.trim();
        let url = "/api/weather-scraper";
        if (provinceId) {
          url += `?provinceId=${encodeURIComponent(provinceId)}`;
        }

        try {
          const response = await fetch(url, { signal: signal });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.details || "Unknown error");
          }

          const result = await response.json();
          const weatherData = result.data;

          if (weatherData.length > 0) {
            let html = `<div class='mb-4'><h3 class='text-xl font-bold text-gray-800 dark:text-gray-200 mb-2'>ğŸŒ¤ï¸ å¤©æ°”ç»“æœ (å…± ${weatherData.length} ä¸ªåŸå¸‚)</h3></div>`;
            html += '<div class="weather-list">';
            weatherData.forEach((item, index) => {
              html += `
              <div class="weather-card">
                <div class="weather-city">${item.cityName}</div>
                <div class="weather-info">${item.weatherInfo}</div>
                <div class="text-xs text-gray-400 mt-1">#${index + 1}</div>
              </div>
            `;
            });
            html += "</div>";
            weatherResults.innerHTML = html;
          } else {
            weatherResults.innerHTML =
              "<div class='text-center py-8'><div class='text-4xl mb-2'>ğŸŒ§ï¸</div><p class='text-gray-500'>æœªæ‰¾åˆ°å¤©æ°”æ•°æ®</p></div>";
          }
        } catch (error) {
          if (error.name === "AbortError") {
            weatherResults.innerHTML =
              '<p class="text-yellow-500 text-center">å¤©æ°”çˆ¬å–å·²æš‚åœ</p>';
          } else {
            console.error("Error fetching weather data:", error);
            weatherResults.innerHTML = `<p class="text-red-500 text-center">è·å–å¤©æ°”æ•°æ®å‡ºé”™: ${error.message}</p>`;
          }
        }
        hideButton(pauseWeatherButton);
        hideButton(resumeWeatherButton);
        showButton(fetchWeatherButton);
      });

      // æš‚åœå’Œç»§ç»­æŒ‰é’®
      pauseVegetableButton?.addEventListener("click", () => {
        if (vegetableAbortController) {
          vegetableAbortController.abort();
          isVegetablePaused = true;
          hideButton(pauseVegetableButton);
          showButton(resumeVegetableButton);
          vegetableResults.innerHTML =
            '<p class="text-yellow-500 text-center">è”¬èœçˆ¬å–å·²æš‚åœ</p>';
        }
      });

      resumeVegetableButton?.addEventListener("click", () => {
        isVegetablePaused = false;
        hideButton(resumeVegetableButton);
        showButton(pauseVegetableButton);
        document.getElementById("start-page").value = currentVegetablePage;
        vegetableForm.dispatchEvent(new Event("submit"));
      });

      pauseWeatherButton?.addEventListener("click", () => {
        if (weatherAbortController) {
          weatherAbortController.abort();
          isWeatherPaused = true;
          hideButton(pauseWeatherButton);
          showButton(resumeWeatherButton);
          weatherResults.innerHTML =
            '<p class="text-yellow-500 text-center">å¤©æ°”çˆ¬å–å·²æš‚åœ</p>';
        }
      });

      resumeWeatherButton?.addEventListener("click", () => {
        isWeatherPaused = false;
        hideButton(resumeWeatherButton);
        showButton(pauseWeatherButton);
        fetchWeatherButton.click();
      });
    };

    // è¾…åŠ©å‡½æ•°
    var showButton = function (button) {
      if (button) button.style.display = "inline-block";
    };

    var hideButton = function (button) {
      if (button) button.style.display = "none";
    };
  } // ç»“æŸå‡½æ•°å£°æ˜æ£€æŸ¥

  // ç›‘å¬Swupé¡µé¢åˆ‡æ¢äº‹ä»¶
  if (typeof window !== "undefined") {
    // ç­‰å¾…SwupåŠ è½½å®Œæˆ
    const waitForSwup = () => {
      if (window.swup) {
        // ç›‘å¬é¡µé¢å®Œå…¨åŠ è½½å®Œæˆäº‹ä»¶
        window.swup.hooks.on("page:view", () => {
          if (window.location.pathname === "/tools") {
            // é‡ç½®åˆå§‹åŒ–çŠ¶æ€å¹¶é‡æ–°åˆå§‹åŒ–
            if (window.toolsPageReady) {
              window.toolsPageReady.initialized = false;
            }
            setTimeout(initializeToolsPage, 200);
          }
        });
      } else {
        setTimeout(waitForSwup, 100);
      }
    };
    waitForSwup();
  }
</script>
